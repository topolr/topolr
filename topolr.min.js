/**
 * version:1.6.3
 * desc:topolr frontend base library
 * site:http://topolr.org/
 * git:https://github.com/topolr/topolr.git
 * author:WangJinliang(hou80houzhu)
 * hash:dbea692430b205a970d51f6e2d0af273
 */
!function(){"use strict";var t={version:"1.6.3"},e=function(t){return new h(t)},n=function(){var t={kenel:[{n:"webkit",g:/applewebkit\/([\d.]+)/},{n:"gecko",g:/gecko\/([\d.]+)/},{n:"trident",g:/trident\/([\d.]+)/},{n:"edge",g:/edge\/([\d.]+)/}],info:[{n:"chrome",g:/chrome\/([\d.]+)/},{n:"mozilla",g:/mozilla\/([\d.]+)/},{n:"firefox",g:/firefox\/([\d.]+)/},{n:"msie",g:/msie ([\d.]+)/},{n:"opera",g:/opera\/([\d.]+)/},{n:"safari",g:/safari\/([\d.]+)/},{n:"blackberry",g:/blackberry ([\d.]+)/},{n:"blackberry",g:/edge ([\d.]+)/}],os:[{n:"windows",g:/windows ([a-z\d. ]+)/},{n:"osx",g:/mac os x ([a-z\d. ]+)/},{n:"ios",g:/os ([a-z\d. _]+)/},{n:"linux",g:/linux ([a-z\d. _]+)/},{n:"linux",g:/linux/},{n:"blackberry",g:/blackberry ([a-z\d. ]+)/},{n:"blackberry",g:/bb[0-9]+/},{n:"windowsphone",g:/windows phone/}],mobile:[{n:"android",g:/android ([\d.]+)/},{n:"iphone",g:/iphone/},{n:"ipad",g:/ipad/},{n:"blackberry",g:/bb[0-9]+/},{n:"blackberry",g:/blackberry/},{n:"windowsphone",g:/iemobile/}]},e=window.navigator.userAgent.toLowerCase(),n={};for(var r in t){var i=!1;for(var o in t[r]){var s=t[r][o],a=e.match(s.g);if(a){var l=a[0].match(/[0-9._]+/);n[r]={name:s.n,version:l?l[0]:"unknow"},i=!0;break}}i||(n[r]={name:"unknow",version:"unknow"})}return n.kenel&&"trident"===n.kenel.name&&"7.0"===n.kenel.version&&(n.info={name:"msie",version:"11"}),n.name=function(){return n.info.name},n.version=function(){return n.info.verison},n.isMobile=function(){return"unknow"!==this.mobile.name},n.isAndroid=function(t){return 0===arguments.length?"android"===this.mobile.name:"android"===this.mobile.name&&parseInt(this.mobile.version)===parseInt(t)},n.isIos=function(t){return 0===arguments.length?"iphone"===this.mobile.name||"ipad"===this.mobile.name:("iphone"===this.mobile.name||"ipad"===this.mobile.name)&&parseInt(this.mobile.version)===parseInt(t)},n.isWebkit=function(t){return 0===arguments.length?"webkit"===this.kenel.name:"webkit"===this.kenel.name&&parseInt(this.kenel.version)===parseInt(t)},n.isGecko=function(t){return 0===arguments.length?"gecko"===this.kenel.name:"gecko"===this.kenel.name&&parseInt(this.kenel.version)===parseInt(t)},n.isTrident=function(){return"trident"===this.kenel.name},n.isEdge=function(){return"edge"===this.kenel.name},n.isIe=function(t){return 0===arguments.length?"msie"===this.info.name:"msie"===this.info.name&&parseInt(this.info.version)===parseInt(t)},n.isSupport=function(){return"webkit"===this.kenel.name||"gecko"===this.kenel.name||"trident"===this.kenel.name&&this.kenel.version/1>=6},n}(),r={isFunction:function(t){return"function"==typeof t&&t.constructor===window.Function},isEmptyObject:function(t){for(var e in t)return!1;return!0},isUndefined:function(t){return void 0===t},isWindow:function(t){return void 0!==t&&null!==t&&t===t.window},isDocument:function(t){return null!==t&&t.nodeType===t.DOCUMENT_NODE},isObject:function(t){return"object"==typeof t&&"[object object]"===Object.prototype.toString.call(t).toLowerCase()&&!t.length},isString:function(t){return"string"==typeof t&&t.constructor===String},isNumber:function(t){return"number"==typeof t},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isAvalid:function(t){return null!==t&&void 0!==t},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isQueryString:function(t){return r.isString(t)&&/(^|&).*=([^&]*)(&|$)/.test(t)},isElement:function(t){return t&&1===t.nodeType&&t.nodeName},isSameArray:function(t,e){if(t===e)return!0;if(t.length===e.length){for(var n=!1,r=0;r<t.length;t++)if(-1===e.indexOf(t[r])){n=!0;break}return!n}return!1}},i={postData:function(t){if(t){if(t instanceof FormData||t instanceof Blob||t instanceof ArrayBuffer)return t;if(r.isObject(t)){var e=!1;for(var n in t)if(t[n]instanceof Blob||t[n]instanceof ArrayBuffer||t[n]instanceof File){e=!0;break}if(e){var s=new FormData;for(var n in t)t[n]instanceof Blob?s.append(n,t[n]):t[n]instanceof File?s.append(n,t[n]):r.isArray(t[n])||r.isObject(t[n])?s.append(n,window.encodeURIComponent(o.stringify(t[n]))):t[n]instanceof FormData||s.append(n,window.encodeURIComponent(t[n].toString()));return s}return i.queryString(t)}return r.isArray(t)?window.encodeURIComponent(o.stringify({key:t})):t}return null},queryString:function(t){var e="";if(t){for(var n in t){var i=t[n];r.isString(i)?e+=n+"="+window.encodeURIComponent(i)+"&":r.isObject(i)||r.isArray(i)?e+=n+"="+window.encodeURIComponent(o.stringify(i))+"&":i instanceof FormData||i instanceof Blob||i instanceof File||i instanceof ArrayBuffer||(e+=n+"="+(void 0!==i&&null!==i?window.encodeURIComponent(i.toString()):"")+"&")}return e.length>0?e.substring(0,e.length-1):""}return""},getURLInfo:function(t){var e=t.indexOf("?"),n=t.indexOf("#"),r="",i="",o=null,s=null,a=t,l=null,u=null;-1!==e&&-1!==n?(a=t.substring(0,e),e>n?(i=t.substring(n+1,e),r=t.substring(e+1)):(r=t.substring(e+1,n),i=t.substring(n+1))):-1!==e?(r=t.substring(e+1),a=t.substring(0,e)):-1!==n&&(i=t.substring(n+1),a=t.substring(0,n));var c=t.match(/:[0-9]+/g),p=t.match(/[a-z]+:\/\//);l=c?c[c.length-1].substring(1):null,u=p?p[0].substring(0,p[0].length-3):null,u&&(a=a.substring(u.length+3)),l&&(a=a.substring(0,a.length-l.length-1));var h=a.substring(0,a.indexOf("/"));if(a=""===h?a:h,""!==r){o={};for(var d=r.split("&"),f=0;f<d.length;f++){var g=d[f].split("=");o[g[0]]=g[1]}}if(""!==i){s={};for(var d=i.split("&"),f=0,v=d.length;v>f;f++){var g=d[f].split("=");s[g[0]]=g[1]}}return{query:o,hash:s,host:a,port:l,protocol:u}},queryObject:function(t){return i.getURLInfo(t).query},hashObject:function(t){return i.getURLInfo(t).hash}},o={parse:function(t){return window.JSON.parse(t)},stringify:function(t){return window.JSON.stringify(t)},each:function(t,e){var n,i=0,o=t.length,s=void 0===o||r.isFunction(t);if(s){for(n in t)if(e.call(t[n],n,t[n])===!1)break}else for(;o>i&&e.call(t[i],i,t[i++])!==!1;);return t},clone:function(t){var e;if(r.isArray(t)){e=[];for(var n=0;n<t.length;n++)e[n]=o.clone(t[n]);return e}if(r.isObject(t)){e={};for(var n in t)e[n]=o.clone(t[n]);return e}return t},cover:function(){var t,e,n,i,s,a,l=arguments[0]||{},u=1,c=arguments.length,p=!1;for("boolean"==typeof l&&(p=l,l=arguments[1]||{},u=2),"object"==typeof l||r.isFunction(l)||(l={}),c===u&&(l=this,u-=1);c>u;){if(t=arguments[u],null!==t)for(e in t)n=l[e],i=t[e],l!==i&&(s=r.isArray(i),p&&i&&(r.isObject(i)||s)?(s?(s=!1,a=n&&r.isArray(n)?n:[]):a=n&&r.isObject(n)?n:{},l[e]=o.cover(p,a,i)):void 0!==i&&(l[e]=i));u++}return l}},s=function(){var t={};return n.isWebkit()?(t.prefix="-webkit-",t.transitionEnd="webkitTransitionEnd"):"gecko"===n.isGecko()?(t.prefix="-moz-",t.transitionEnd="transitionend"):(t.prefix="",t.transitionEnd="transitionend"),t.fix=function(t){var e=/^-all-/;if(r.isString(t))return t.replace(e,this.prefix);if(r.isArray(t)){for(var n=[],i=0;i<t.length;i++)n.push(t[i].replace(e,this.prefix));return n}if(r.isObject(t)){var o={};for(var i in t)o[i.replace(e,this.prefix)]=r.isString(t[i])?t[i].replace(e,this.prefix):t[i];return o}return t},t}(),l={uuid:function(){for(var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),r=0,i=0;36>i;i++)8===i||13===i||18===i||23===i?n[i]="":14===i?n[i]="4":(2>=r&&(r=33554432+16777216*Math.random()|0),t=15&r,r>>=4,n[i]=e[19===i?3&t|8:t]);return n.join("")},randomid:function(t){return(0===arguments.length||2>=t)&&(t=7),Math.random().toString(36).slice(2,t+2)},getDatasetName:function(t){for(var e="",n=0;n<t.length;n++)e+=/^[A-Z]+$/.test(t.charAt(n))?"-"+t.charAt(n).toLowerCase():t.charAt(n);return"data-"+e},getDatasetReserve:function(t){return t.substring(4).replace(/-[a-zA-Z]{1}/g,function(t){return t[1].toUpperCase()})},escape:function(t){return(""+t).replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/'/g,"'").replace(/\//g,"/")},hashCode:function(t){var e=0;if(0===t.length)return e;for(var n=0,r=t.length;r>n;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return e},setReadOnlyProps:function(t,e){for(var n in e)Object.defineProperty(t,n,{enumerable:!1,configurable:!1,writable:!1,value:e[n]});return t}};e.json=o,e.is=r,e.browser=n,e.prefix=s,e.util=l,e.serialize=i,e.extend=e.json.cover,e.nfn=function(){};var u=function(){this.list=[],this.length=null,this.current=null,this.state="init",this._start=null,this._progress=null,this._complete=null,this.result=null,this._scope=null};u.prototype.add=function(t,e,n){if("init"!==this.state)throw Error("[topolr]-this queue can not add task when it is not in state of init.");return this.list.push({fn:t,parameter:n,error:e||null}),this},u.prototype.delay=function(t){this.add(function(){var e=this;setTimeout(function(){e.next()},t)})},u.prototype.scope=function(t){return 0===arguments.length?this._scope:(this._scope=arguments[0],this)},u.prototype.next=function(t){return this._progress&&this._progress.call(this,{total:this.length,runed:this.length-this.list.length,data:t}),u._fire.call(this,t),this},u.prototype.left=function(){return this.list.length},u.prototype.total=function(){return this.length},u.prototype.run=function(t){null===this.length&&(this._start&&this._start.call(this),this.length=this.list.length),this.state="running",u._fire.call(this,t)},u.prototype.stop=function(){return"running"===this.state&&(this.state="stop"),this},u.prototype.reset=function(){return null===this.length,this.state="init",this.result=null,this._scope=null,this},u.prototype.clean=function(){return this.list.length=0,this.state="end",this.length=0,this.reuslt=null,this},u.prototype.isRunning=function(){return"running"===this.state},u.prototype.isEnd=function(){return"end"===this.state},u.prototype.isStop=function(){return"stop"===this.state},u.prototype.start=function(t){return t&&(this._start=t),this},u.prototype.progress=function(t){return t&&(this._progress=t),this},u.prototype.complete=function(t){return t&&(this._complete=t),"end"===this.state&&this._complete.call(this,this.result),this},u.prototype.end=function(t){return this.state="end",this.result=t,this._complete.call(this,this.result),this.reset(),this},u.prototype.pass=function(){this.list.shift()},u._fire=function(t){if(this.list.length>0){var e=this.list.shift(),n=this;this.current=e;try{e.fn&&e.fn.call(n,t,e.parameter)}catch(r){u.error.call(this,t,r),this.next(t)}}else"end"!==this.state&&(this.state="end",this.result=t,this._complete&&this._complete.call(this,t));return this},u.error=function(t,e){this.current&&this.current.error&&this.current.error.call(this,t,e,this.current.parameter)},e.queue=function(){return new u};var c=function(){this.state="waiting",this.__list__=[],this.result=null,this.current=null,this._complete=null,this._notify=null,this.waits=1,this._completeTimes=0,this._handleTimes=0};c.prototype.add=function(t,e,n){return this.__list__.push({fn:t,error:e,parameters:n}),"waiting"===this.state&&this.__list__.length===this.waits&&c._fire.call(this,this.result),this},c.prototype.size=function(){return this.__list__.length},c.prototype.wait=function(t){return(0===arguments.length||0===t)&&(t=1e7),this.waits=t,this},c.prototype.work=function(t){return"waiting"===this.state&&(this.waits=1,c.next.call(this,t)),this},c.prototype.delay=function(t){return this.add(function(e){var n=this;setTimeout(function(){n.next(e)},t)}),this},c.prototype.notify=function(t){return t&&(this._notify=t),this},c.prototype.complete=function(t){return t&&(this._complete=t),this},c.prototype.isRunning=function(){return"running"===this.state},c.prototype.isWaiting=function(){return"waiting"===this.state},c.prototype.isHandleAtOnce=function(){return"running"===this.state&&this.__list__.length>0},c.prototype.completeTimes=function(){return this._completeTimes},c.prototype.handleTimes=function(){return this._handleTimes},c.prototype.clean=function(){this.__list__.length=0,this.state="waiting";for(var t in this)this[t]=null},c.prototype.next=function(t){return c.next.call(this,t),this},c.prototype.error=function(t){return c.error.call(this,t)},c.next=function(t){return this._notify&&this._notify.call(this,t),c._fire.call(this,t),this},c.error=function(t){return this.current&&this.current.error&&this.current.error(this,t),this},c._fire=function(t){if(this.__list__.length>0){this.state="running",this._handleTimes=this._handleTimes+1;var e=this.__list__.shift(),n=this;this.current=e;try{e.fn&&e.fn.call(n,t,e.parameters)}catch(r){c.error.call(r),c.next.call(n,t)}}else"running"===this.state&&(this.result=t,this.state="waiting",this._completeTimes=this._completeTimes+1,this.current=null),this._complete&&this._complete.call(this,t);return this},e.dynamicQueue=function(){return new c};var p=function(t){this._state=0,this._scope={},this._queue=new u,this._complete=null,this._finally=null,this._always=null,this._error=null,this._notify=null;var e=this;this._queue.complete(function(t){1===e._state?e._error&&e._error.call(e._scope,t):e._complete&&e._complete.call(e._scope,t),e._always&&e._always.call(e._scope,t,{state:e._state}),e._finally&&e._finally.call(e._scope,t,e._state)}),this._queue.progress(function(t){e._notify&&e._notify.call(e._scope,t)}),t&&setTimeout(function(){try{t.call(e._scope,function(t){e._state=0,e._queue.run(t)},function(t){e._state=1,e._queue.run(t)})}catch(n){console.error(n.stack),e._state=1,e._queue.end()}},0)};p.prototype.scope=function(t){return 1===arguments.length?(this._scope=t,this):this._scope},p.prototype.then=function(t,e){return this._done(t),this._fail(e),this},p.prototype.wait=function(t){var e=this;return this._done(function(n){t?t&&t.call(e._scope,n,function(t){e.next(t)}):e.next(n)}),this},p.prototype._done=function(t){var e=this;return this._queue.add(function(t,n){if(0===e._state)if(n){var r=n.call(e._scope,t);r instanceof p?r._finally=function(t){1===r._state&&(e._state=r._state,e._queue.pass()),e._queue.next(t)}:e._queue.next(r)}else e._queue.next(t);else e._queue.next(t)},function(t,n){e._state=1,e._queue.pass(),e._queue.next(n)},t),this},p.prototype._fail=function(t){var e=this;return this._queue.add(function(t,n){if(1===e._state)if(n){var r=n.call(e._scope,t);r instanceof p?r._finally=function(t){e._queue.next(t)}:e._queue.next(r)}else e._queue.next(t);else e._queue.next(t)},function(t,n){e._state=1,e._queue.next(n)},t),this},p.prototype.done=function(t){return r.isFunction(t)&&(this._complete=t),this},p.prototype.fail=function(t){return r.isFunction(t)&&(this._error=t),this},p.prototype.always=function(t){return r.isFunction(t)&&(this._always=t),this},p.prototype.reject=function(t){return setTimeout(function(){this._state=1,this._queue.run(t)}.bind(this),0),this},p.prototype.resolve=function(t){return setTimeout(function(){this._state=0,this._queue.run(t)}.bind(this),0),this},p.prototype.notify=function(t){return r.isFunction(t)&&(this._notify=t),this},p.prototype.delay=function(t){return this._queue.delay(t),this},p.prototype.clean=function(){this.queue.clean();for(var t in this)this[t]=null},e.promise=function(t){return new p(t)};var h=function(t){if(this.nodes=[],this.length=0,1===arguments.length&&r.isAvalid(t))if(r.isString(t))h.util.isHTML(t)?this.nodes=h.util.parseHTML(t):this.nodes=h.util.query(window.document,t),this.length=this.nodes.length;else if(t instanceof g)this.nodes=t.nodes,this.length=t.length;else{if(r.isWindow(t)||r.isDocument(t))return new v(t);1===t.nodeType?(this.nodes=[t],this.length=1):(this.nodes=[],this.length=0)}else 0===arguments.length&&(this.nodes=[],this.length=0)};h.regs={root:/^(?:body|html)$/i,_class:/^\.([\w-]+)$/,_id:/^#([\w-]*)$/,_tag:/^[\w-]+$/,_html:/^\s*<(\w+|!)[^>]*>/,_tagName:/<([\w:]+)/,_property:/-+(.)?/g},h.util={getDom:function(t){var e=new h;return 1===arguments.length?(e.nodes=t,e.length=t.length):(e.nodes=[],e.length=0),e},isClass:function(t){return h.regs._class.test(t)},isId:function(t){return h.regs._id.test(t)},isTag:function(t){return h.regs._tag.test(t)},isHTML:function(t){return h.regs._html.test(t)},query:function(t,e){var n=null;switch(!0){case this.isId(e):var r=document.getElementById(e.substring(1,e.length));n=r?[r]:[];break;case this.isClass(e):var i=t.getElementsByClassName(e.substring(1,e.length));n=Array.prototype.slice.call(i);break;case this.isTag(e):var i=t.getElementsByTagName(e);n=Array.prototype.slice.call(i);break;default:n=Array.prototype.slice.call(t.querySelectorAll(e))}return n},queryChild:function(t,e){var n=t.getAttribute("id")||"__bright__";t.setAttribute("id",n);var r=h.util.query(t,"#"+n+">"+e);return"__bright__"===n&&t.removeAttribute("id"),r},queryChildAll:function(t,e){var n=t.getAttribute("id")||"__bright__";t.setAttribute("id",n);var r=h.util.query(t,"#"+n+" "+e);return"__bright__"===n&&t.removeAttribute("id"),r},repairTags:{area:{l:1,s:"<map>",e:""},param:{l:1,s:"<object>",e:""},col:{l:2,s:"<table><tbody></tbody><colgroup>",e:"</table>"},legend:{l:1,s:"<fieldset>"},option:{l:1,s:"<select multiple='multiple'>",e:""},thead:{l:1,s:"<table>",e:"</table>"},tr:{l:2,s:"<table><tbody>",e:""},td:{l:3,s:"<table><tbody><tr>",e:""},_general:{s:"",e:"",l:0}},parseHTML:function(t){var e=t.match(h.regs._tagName),n=h.util.repairTags[e?e[1]:"_general"]||h.util.repairTags._general,r=document.createElement("DIV");r.innerHTML=n.s+t+n.e;for(var i=r,o=0;o<n.l;o++)i=i.firstChild;return Array.prototype.slice.call(i.childNodes)},parseFlagment:function(t){var e=h.util.parseHTML(t),n=window.document.createDocumentFragment();for(var r in e)n.appendChild(e[r]);return n},propertyName:function(t){return t.replace(h.regs._property,function(t,e,n){return 0===n?t.substring(1,2):e?e.toUpperCase():""})},cleanNode:function(t){if(t){if(t.datasets){for(var e in t.datasets){var n=t.datasets[e];n&&n.clean&&n.clean(),t.datasets[e]=null}t.datasets=null}m.util.unbindnode(t);var r=t.getElementsByClassName("incache");for(var i in r)if(r[i].nodeType){for(var o in r[i].datasets){var s=r[i].datasets[o];s&&s.clean&&s.clean(),r[i].datasets[o]=null}r[i].datasets=null,m.util.unbindnode(r[i])}}},supported:function(t){return 1===arguments.length?r.isString(t)||t instanceof h||r.isWindow(t)||r.isDocument(t)||1===t.nodeType:!1}};var d=function(t){this.dom=t,this.mapping={},d.init.call(this),this.dom.get(0).addEventListener(s.transitionEnd,d.fn,!1),this.dom.data("_transition_",this)};d.fn=function(t){var n=e(t.currentTarget).data("_transition_"),r=t.propertyName;n.mapping[r]?n.mapping[r].promise&&n.mapping[r].promise.resolve():n.mapping[s.prefix+r]?n.mapping[s.prefix+r].promise&&n.mapping[s.prefix+r].promise.resolve():n.mapping.all&&n.mapping.all.promise&&n.mapping.all.promise.resolve()},d.setCss=function(){var t="";for(var e in this.mapping)this.mapping[e]&&(t+=e+" "+this.mapping[e].time+"ms "+this.mapping[e].type+" "+this.mapping[e].delay+"ms,");t=t.length>0?t.substring(0,t.length-1):"none",this.dom.css(s.prefix+"transition",t)},d.init=function(){for(var t=this.dom.css("-all-transition-timing-function").split(","),e=this.dom.css("-all-transition-delay").split(","),n=this.dom.css("-all-transition-duration").split(","),r=this.dom.css("-all-transition-property").split(","),i=0;i<r.length;i++)"all"!==r[i]&&(this.mapping[r[i]]={property:r[i],time:1e3*parseFloat(n[i]),type:t[i],delay:1e3*parseFloat(e[i]),fn:null})},d.prototype.set=function(t,n){var r={time:200,type:"ease-out",delay:0},i=new p;i.scope(this.dom),e.extend(r,n);for(var o=s.fix(t.split(",")),a=0;a<o.length;a++){var l=o[a];if("all"===l){this.mapping={all:{property:l,time:r.time,type:r.type,delay:r.delay,promise:i}};break}this.mapping[l]={property:l,time:r.time,type:r.type,delay:r.delay,promise:i}}return d.setCss.call(this),i},d.prototype.all=function(t){var n={time:200,type:"ease-out",delay:0},r=new p;return r.scope(this.dom),e.extend(n,t),this.mapping={all:{property:"all",time:n.time,type:n.type,delay:n.delay,promise:r}},d.setCss.call(this),r},d.prototype.get=function(t){var e=this.mapping[s.fix(t)];return e?{type:e.type,time:e.time,delay:e.delay,property:t}:e},d.prototype.remove=function(t){for(var e=s.fix(t.split(",")),n=0;n<e.length;n++)this.mapping[e[n]]&&(this.mapping[e[n]]=null);return d.setCss.call(this),this},d.prototype.removeAll=function(){return this.mapping={},d.setCss.call(this),this},d.prototype.scope=function(){return this.dom},d.prototype.clean=function(){this.dom.get(0).removeEventListener(s.transitionEnd,d.fn,!1);for(var t in this)this[t]=null};var f=function(t){this.dom=t,this.attrs=[],this.setter=[],f.defaultValue.call(this),t.data("_transform_",this)};f.parse=function(){var t=this.dom.css(s.prefix+"transform"),e=t.match(/(-?[0-9\.]+)/g);if(e){e.length>6&&e.shift();for(var n=0;n<e.length;n++)e[n]=e[n]/1}else e=[1,0,0,1,0,0];return e},f.defaultValue=function(){var t={translate:[0,0],translate3d:[0,0,0],translateX:0,translateY:0,translateZ:0,rotate:0,rotateX:0,rotateY:0,rotateZ:0,rotate3d:[0,0,0,1],scale:[1,1],scaleX:1,scaleY:1,scaleZ:1,scale3d:[1,1,1],skew:[0,0],skewX:0,skewY:0},e=f.parse.call(this);if(e){if(1!==e[0]){var n=this.dom.get(0),r=n.style.webkitTransform||n.style.mozTransform||n.style.msTransform||n.style.transform;if(r||""===r){var i=document.styleSheets;n.matches=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector;for(var o=0;o<i.length;o++)for(var s=i[o].cssRules||i[o].rules,a=0;a<s.length;a++)n.matches(s[a].selectorText)&&(r=s[a].style.webkitTransform||s[a].style.mozTransform||s[a].style.msTransform||s[a].style.transform)}if(r&&""!==r){for(var l=[],u=[],c="",p="",h=!0,o=0;o<r.length;o++){var d=r[o];"("!==d&&")"!==d?h?c+=d:p+=d:"("===d?(l.push(c.trim()),c="",h=!1):")"===d&&(u.push(p.trim()),p="",h=!0)}for(var o=0;o<l.length;o++){var g="";if(-1!==u[o].indexOf(",")){for(var v=u[o].split(","),m=0;m<v.length;m++)v[m]=parseFloat(v[m]);g=v}else g=parseFloat(u[o]);t[l[o]]=g}}}6===e.length?(t.translate3d=[e[4],e[5],0],t.translateX=e[4],t.translateY=e[5]):(t.translate3d=[e[12],e[13],e[14]],t.translateX=e[12],t.translateY=e[13],t.translateZ=e[14])}this.values=t},f.watcher={translate:function(){return"translate3d("+(r.isNumber(this.values.translate3d[0])?this.values.translate3d[0]+"px":this.values.translate3d[0])+","+(r.isNumber(this.values.translate3d[1])?this.values.translate3d[1]+"px":this.values.translate3d[1])+","+(r.isNumber(this.values.translate3d[2])?this.values.translate3d[2]+"px":this.values.translate3d[2])+")"},rotate3d:function(){var t="0000"!==this.values.rotate3d.join("")?"rotate3d("+this.values.rotate3d[0]+","+this.values.rotate3d[1]+","+this.values.rotate3d[2]+","+this.values.rotate3d[3]+"deg)":"";return t+=0!==this.values.rotateX?" rotateX("+this.values.rotateX+"deg)":"",t+=0!==this.values.rotateY?" rotateY("+this.values.rotateY+"deg)":"",t+=0!==this.values.rotateZ?" rotateZ("+this.values.rotateZ+"deg)":""},scale3d:function(){var t="111"!==this.values.scale3d.join("")?"scale3d("+this.values.scale3d[0]+","+this.values.scale3d[1]+","+this.values.scale3d[2]+")":"";return t+=1!==this.values.scaleX?" scaleX("+this.values.scaleX+")":"",t+=1!==this.values.scaleY?" scaleY("+this.values.scaleY+")":"",t+=1!==this.values.scaleZ?" scaleZ("+this.values.scaleZ+")":""},scale:function(){return"11"!==this.values.scale.join("")?"scale("+this.values.scale[0]+","+this.values.scale[1]+")":""},skew:function(){return"00"!==this.values.skew.join("")?"skew("+this.values.skew[0]+"deg,"+this.values.skew[1]+"deg)":""},rotate:function(){return 0!==this.values.rotate?"rotate("+this.values.rotate+"deg)":""}},f.watch=function(t){-1===this.attrs.indexOf(t)&&f.watcher[t]&&(this.attrs.push(t),this.setter.push(f.watcher[t]))},f.watchName=function(t){return-1!==t.indexOf("translate")?"translate":-1!==t.indexOf("skew")?"skew":-1!==t.indexOf("rotate")?"rotate3d"===t?"rotate3d":"rotate":-1!==t.indexOf("scale")?"scale3d"===t?"scale3d":"rotate":""},f.set=function(){var t="";for(var e in this.setter)t+=this.setter[e].call(this)+" ";this.dom.css(s.prefix+"transform",t)},f.translate=function(t,e,n){if(2===arguments.length){var r=this.values.translate3d[t];return/^[-0-9\.]*$/.test(r)===!1&&f.defaultValue.call(this),this.values.translate3d[t]}return this.values.translate3d[t]=n,this.values.translate[t]=n,this.values[e]=n,f.set.call(this),this},f.sett=function(t,e,n){return 2===arguments.length?this.values[t]:((void 0===n||null===n)&&(n=e),this.values[t]=n,f.set.call(this),this)},f.prototype.matrix=function(){return f.parse.call(this)},f.prototype.sets=function(t){for(var e in t)void 0!==this.values[e]&&(this.values[e]=t[e],f.watch.call(this,f.watchName(e)));return f.set.call(this),this},f.prototype.scale=function(t,e){return f.watch.call(this,"scale"),0===arguments.length?this.values.scale:((void 0===t||null===t)&&(t=1),(void 0===e||null===e)&&(e=1),this.values.scale[0]=t,this.values.scale[1]=e,f.set.call(this),this)},f.prototype.rotate=function(t){return f.watch.call(this,"rotate"),0===arguments.length?this.values.rotate:((void 0===t||null===t)&&(t=0),this.values.rotate=t,f.set.call(this),this)},f.prototype.scale3d=function(t,e,n){return f.watch.call(this,"scale3d"),0===arguments.length?this.values.scale3d:((void 0===t||null===t)&&(t=1),(void 0===e||null===e)&&(e=1),(void 0===n||null===n)&&(n=1),this.values.scale3d[0]=t,this.values.scale3d[1]=e,this.values.scale3d[2]=n,f.set.call(this),this)},f.prototype.rotate3d=function(t,e,n,r){return f.watch.call(this,"rotate3d"),0===arguments.length?this.values.rotate3d:((void 0===t||null===t)&&(t=0),(void 0===e||null===e)&&(e=0),(void 0===n||null===n)&&(n=0),(void 0===r||null===r)&&(r=0),this.values.rotate3d[0]=t,this.values.rotate3d[1]=e,this.values.rotate3d[2]=n,this.values.rotate3d[3]=r,f.set.call(this),this)},f.prototype.skew=function(t,e){return f.watch.call(this,"skew"),0===arguments.length?this.values.skew:((void 0===t||null===t)&&(t=1),(void 0===e||null===e)&&(e=1),this.values.skew[0]=t,this.values.skew[1]=e,f.set.call(this),this)},f.prototype.x=function(t){return f.watch.call(this,"translate"),f.translate.apply(this,0===arguments.length?[0,"translateX"]:[0,"translateX",t])},f.prototype.y=function(t){return f.watch.call(this,"translate"),f.translate.apply(this,0===arguments.length?[1,"translateY"]:[1,"translateY",t])},f.prototype.z=function(t){return f.watch.call(this,"translate"),f.translate.apply(this,0===arguments.length?[2,"translateZ"]:[2,"translateZ",t])},f.prototype.scaleX=function(t){return f.watch.call(this,"scale"),f.sett.apply(this,0===arguments.length?["scaleX",1,t]:["scaleX",1,t])},f.prototype.scaleY=function(t){return f.watch.call(this,"scale"),f.sett.apply(this,0===arguments.length?["scaleY",1,t]:["scaleY",1,t])},f.prototype.scaleZ=function(t){return f.watch.call(this,"scale"),f.sett.apply(this,0===arguments.length?["scaleZ",1,t]:["scaleZ",1,t])},f.prototype.rotateX=function(t){return f.watch.call(this,"rotate"),f.sett.apply(this,0===arguments.length?["rotateX",0,t]:["rotateX",0,t])},f.prototype.rotateY=function(t){return f.watch.call(this,"rotate"),f.sett.apply(this,0===arguments.length?["rotateY",0,t]:["rotateY",0,t])},f.prototype.rotateZ=function(t){return f.watch.call(this,"rotate"),f.sett.apply(this,0===arguments.length?["rotateZ",0,t]:["rotateZ",0,t])},f.prototype.skewX=function(t){return f.watch.call(this,"skew"),f.sett.apply(this,0===arguments.length?["skewX",0,t]:["skewX",0,t])},f.prototype.skewY=function(t){return f.watch.call(this,"skew"),f.sett.apply(this,0===arguments.length?["skewY",0,t]:["skewY",0,t])},f.prototype.origin=function(t,e){if(0===arguments.length){var t=this.dom.css(s.prefix+"transform-origin").split(" ");return{x:t[0],y:t[1]}}return 2===arguments.length?(this.dom.css(s.prefix+"transform-origin",t+" "+e),this):void 0},f.prototype.style=function(t){return 0===arguments.length?this.dom.css(s.prefix+"transform-style"):(this.dom.css(s.prefix+"transform-style",t),this)},f.prototype.perspective=function(t){return 0===arguments.length?this.dom.css(s.prefix+"perspective"):(this.dom.css(s.prefix+"perspective",t),this)},f.prototype.perspectiveOrigin=function(){if(0===arguments.length){var t=this.dom.css(s.prefix+"perspective-origin").split(" ");return{x:t[0],y:t[1]}}return 2===arguments.length?this.dom.css(s.prefix+"perspective-origin",t+" "+b):void 0},f.prototype.backface=function(){return 0===arguments.length?this.dom.css(s.prefix+"backface-visibility"):(this.dom.css(s.prefix+"backface-visibility",a),this)},f.prototype.clean=function(){for(var t in this)this[t]=null},f.prototype.scope=function(){return this.dom};var g=function(){};g.prototype.get=function(t){return t/=1,r.isAvalid(t)&&t>=0&&t<this.nodes.length?this.nodes[t]:null},g.prototype.ready=function(t){var e=/complete|loaded|interactive/;return e.test(window.document.readyState)?t&&t():window.document.addEventListener("DOMContentLoaded",function(){t&&t()},!1),this},g.prototype.find=function(t){var e=[];return this.isEmpty()||r.isString(t)&&(e=h.util.query(this.nodes[0],t)),h.util.getDom(e)},g.prototype.children=function(t){var e=[];return this.isEmpty()||(e=r.isString(t)?h.util.queryChild(this.nodes[0],t):1===arguments.length&&t>=0?this.nodes[0].children[t]?[this.nodes[0].children[t]]:[]:Array.prototype.slice.call(this.nodes[0].children)),h.util.getDom(e)},g.prototype.siblings=function(t){var e=[];if(!this.isEmpty()){var n=[];n=r.isString(t)&&this.nodes[0].parentNode?h.util.queryChild(this.nodes[0].parentNode,t):this.nodes[0].parentNode?Array.prototype.slice.call(this.nodes[0].parentNode.children):[];for(var i=0;i<n.length;i++)n[i]!==this.nodes[0]&&e.push(n[i])}return h.util.getDom(e)},g.prototype.has=function(t){for(var e=[],n=0;n<this.nodes.length;n++){var r=h.util.queryChild(this.nodes[n],t);r.length>0&&e.push(this.nodes[n])}return h.util.getDom(e)},g.prototype.index=function(){var t=-1;if(!this.isEmpty())for(var e=this.nodes[0].parentNode,n=0;n<e.children.length;n++)if(e.children[n]===this.nodes[0]){t=n;break}return t},g.prototype.filter=function(t){var e=[];if(!this.isEmpty()){var n=h.util.query(window.document,t);if(n.length>0)for(var r=0;r<this.nodes.length;r++)-1!==n.indexOf(this.nodes[r])&&e.push(this.nodes[r])}return h.util.getDom(e)},g.prototype.first=function(){var t=[];return this.isEmpty()||t.push(this.get(0)),h.util.getDom(t)},g.prototype.last=function(){var t=[];return this.nodes.length>0&&t.push(this.get(this.length-1)),h.util.getDom(t)},g.prototype.parent=function(){var t=arguments[0],e=[];if(!this.isEmpty())if(r.isString(t))for(var n=h.util.query(window.document,t),i=this.nodes[0].parentNode;i&&!r.isDocument(i);)-1!==n.indexOf(i)&&e.push(i),i=i.parentNode;else if(r.isNumber(t)&&t>0){for(var i=this.nodes[0].parentNode,o=t-1;i&&!r.isDocument(i)&&o>0;)o--,i=i.parentNode;e.push(i)}else this.nodes[0].parentNode&&e.push(this.nodes[0].parentNode);return h.util.getDom(e)},g.prototype.parents=function(){var t=arguments[0],e=[];if(!this.isEmpty()){for(var n=this.nodes[0].parentNode;n&&!r.isDocument(n);)e.push(n),n=n.parentNode;if(r.isString(t)){var i=h.util.query(window.document,t);e=e.filter(function(t){return-1!==i.indexOf(t)?!0:void 0})}}return h.util.getDom(e)},g.prototype.next=function(){var t=[];if(!this.isEmpty()){var e=this.nodes[0].nextSibling;e&&t.push(e)}return h.util.getDom(t)},g.prototype.nexts=function(t){var e=[],n=this;if(!this.isEmpty()){for(var i=this.nodes[0].nextSibling;i;)1===i.nodeType&&e.push(i),i=i.nextSibling;if(r.isString(t)&&this.nodes[0].parentNode){var o=h.util.queryChild(this.nodes[0].parentNode,t);e=e.filter(function(t){return-1!==o.indexOf(t)&&t!==n.nodes[0]?!0:void 0})}}return h.util.getDom(e)},g.prototype.prev=function(){var t=[];if(!this.isEmpty()){var e=this.nodes[0].previousSibling;e&&t.push(e)}return h.util.getDom(t)},g.prototype.prevs=function(t){var e=[],n=this;if(!this.isEmpty()){for(var i=this.nodes[0].previousSibling;i;)1===i.nodeType&&e.push(i),i=i.previousSibling;if(r.isString(t)&&this.nodes[0].parentNode){var o=h.util.queryChild(this.nodes[0].parentNode,t);e=e.filter(function(t){return-1!==o.indexOf(t)&&t!==n.nodes[0]?!0:void 0})}}return h.util.getDom(e)},g.prototype.eq=function(t){var e=[];return t>=0&&t<this.nodes.length&&e.push(this.nodes[t]),h.util.getDom(e)},g.prototype.each=function(t){if(t)for(var e=0,n=this.nodes.length;n>e&&t.call(this.nodes[e],this.nodes[e],e,this.nodes)!==!1;e++);
return this},g.prototype.remove=function(){var t=arguments[0];if(t&&r.isNumber(t)&&t<this.nodes.length){var e=this.nodes[t];e&&(h.util.cleanNode(e),e.parentNode.removeChild(e))}else if(r.isString(t))for(var n=h.util.query(window.document,t),i=0;i<this.nodes.length;i++)n.indexOf(-1!==this.nodes[i])&&this.nodes[i].parentNode&&this.nodes[i].parentNode.removeChild(this.nodes[i]);else for(var i=0;i<this.nodes.length;i++){var e=this.nodes[i];e&&(h.util.cleanNode(e),e.parentNode&&e.parentNode.removeChild(e))}return this},g.prototype.empty=function(){for(var t=0;t<this.nodes.length;t++){for(var e=this.nodes[t].children,n=0;n<e.length;n++)e[n].nodeType&&h.util.cleanNode(e[n]);this.nodes[t].innerHTML=""}return this},g.prototype.clean=function(){for(var t=0;t<=this.nodes.length;t++)h.util.cleanNode(this.nodes[t]);this.nodes=null,this.length=0},g.prototype.clone=function(){var t=[];return this.isEmpty()||t.push(this.nodes[0].cloneNode(!0)),h.util.getDom(t)},g.prototype.wrap=function(t){for(var e=0;e<this.nodes.length;e++){var n=null;if(r.isString(t))n=h.util.parseHTML(t)[0]||null;else if(t instanceof g)n=h.nodes[0];else if(t.nodeType)n=t;else if(r.isFunction(t)){var i=t();r.isString(i)&&(n=h.util.parseHTML(t)[0]||null)}if(n){var o=this.nodes[e];o.parentNode&&(o.parentNode.replaceChild(n,o),n.appendChild(o))}}return this},g.prototype.append=function(){var t=arguments[0];if(!this.isEmpty())if(r.isString(t))for(var e=h.util.parseFlagment(t),n=0;n<this.nodes.length;n++)this.nodes[n].appendChild(e.cloneNode(!0));else if(t instanceof g)for(var n=0;n<this.nodes.length;n++)this.nodes[n].appendChild(t.nodes[0]);else if(t&&t.nodeType)for(var n=0;n<this.nodes.length;n++)this.nodes[n].appendChild(t);else if(r.isFunction(t))for(var n=0;n<this.nodes.length;n++){var i=t.call(this.nodes[n],n,this.nodes[n].innerHTML);h.util.isHTML(i)&&this.nodes[n].appendChild(h.util.parseFlagment(i))}return this},g.prototype.appendTo=function(t){if(!this.isEmpty())if(r.isString(t)){var e=h.util.query(window.document,t);e.length>0&&e[0].appendChild(this.nodes[0])}else t instanceof g?t.length>0&&t.nodes[0].appendChild(this.nodes[0]):t.appendChild(this.nodes[0]);return this},g.prototype.insertBefore=function(t){if(!this.isEmpty())if(r.isString(t)){var e=h.util.query(window.document,t)[0];e&&e.parentNode&&e.parentNode.insertBefore(this.nodes[0],e)}else t instanceof g?!t.isEmpty()&&t.parent().get(0).insertBefore(this.nodes[0],t.get(0)):t.parentNode&&t.parentNode.insertBefore(this.nodes[0],t);return this},g.prototype.insertAfter=function(t){if(!this.isEmpty()){var e=null;if(r.isString(t))var e=h.util.query(window.document,t)[0]||null;else t instanceof g?e=t.nodes[0]||null:t.nodeType&&(e=t);e&&(e.nextSibling?e.parentNode.insertBefore(this.nodes[0],e.nextSibling):e.parentNode.appendChild(this.nodes[0]))}return this},g.prototype.prepend=function(){var t=arguments[0];if(!this.isEmpty())if(r.isString(t))for(var e=h.util.parseFlagment(t),n=0;n<this.nodes.length;n++)0!==this.nodes[n].childNodes.length?this.nodes[n].insertBefore(e.cloneNode(!0),this.nodes[n].firstChild):this.nodes[n].appendChild(e.cloneNode(!0));else if(r.isFunction(t))for(var n=0;n<this.nodes.length;n++){var i=t.call(this.nodes[n],n,this.nodes[n].innerHTML);h.util.isHTML(i)&&(this.nodes[n].childNodes.length>0?this.nodes[n].insertBefore(h.util.parseFlagment(i),this.nodes[n].firstChild):this.nodes[n].appendChild(h.util.parseFlagment(i)))}return this},g.prototype.prependTo=function(t){if(!this.isEmpty())if(r.isString(t)){var e=h.util.query(window.document,t);e.length>0&&(e[0].childNodes.length>0?e[0].insertBefore(this.nodes[0],e[0].firstChild):e[0].appendChild(this.nodes[0]))}else t instanceof g?t.isEmpty()||(t.nodes[0].childNodes.length>0?t.nodes[0].insertBefore(this.nodes[0],t.nodes[0].firstChild):t.nodes[0].appendChild(this.nodes[0])):1===t.nodeType&&(t.children.length>0?t.insertBefore(this.nodes[0],t.firstChild):t.appendChild(this.nodes[0]));return this},g.prototype.before=function(t){if(!this.isEmpty()&&this.nodes[0].parentNode)if(r.isString(t)){var e=h.util.parseFlagment(t);this.nodes[0].parentNode&&this.nodes[0].parentNode.insertBefore(e,this.nodes[0])}else t instanceof h?this.nodes[0].parentNode&&this.nodes[0].parentNode.insertBefore(t.nodes[0],this.nodes[0]):t.nodeType&&this.nodes[0].parentNode&&this.nodes[0].parentNode.insertBefore(t,this.nodes[0]);return this},g.prototype.after=function(t){if(!this.isEmpty()){var e=null;r.isString(t)?e=h.util.parseFlagment(t):t instanceof g?e=t.get(0):t.nodeType&&(e=t),this.nodes[0].nextSibling?this.nodes[0].parentNode&&this.nodes[0].parentNode.insertBefore(e,this.nodes[0].nextSibling):this.nodes[0].parentNode&&this.nodes[0].parentNode.appendChild(e)}return this},g.prototype.replaceWith=function(t){if(!this.isEmpty()){var e=null;r.isString(t)?e=h.util.query(window.document,t)[0]:t instanceof g?e=t.nodes[0]:t.nodeType&&(e=t),e&&e.parentNode.replaceChild(this.nodes[0],e)}return this},g.prototype.equal=function(t){return this===t},g.prototype.same=function(t){var n=!0;if(t=e(t),this.length===t.length){for(var r=0;r<this.nodes.length;r++)if(-1===t.nodes.indexOf(this.nodes[r])){n=!1;break}}else n=!1;return n},g.prototype.css=function(t,e){var n=this;if(!this.isEmpty())if(1===arguments.length&&r.isObject(t)){t=s.fix(t);for(var i=0;i<this.nodes.length;i++){var o=this.nodes[i].style.cssText;";"===!o[o.length-1]&&(o+=";");for(var a in t)o+=a+":"+t[a]+";";this.nodes[i].style.cssText=o}}else if(1===arguments.length&&r.isString(t))t=s.fix(t),n=window.getComputedStyle(this.nodes[0],"").getPropertyValue(t);else if(2===arguments.length)for(var i=0;i<this.nodes.length;i++){var l=s.fix(t);this.nodes[i].style[h.util.propertyName(l)]=e}return n},g.prototype.attr=function(t,e){var n=this;if(!this.isEmpty())if(2===arguments.length){if(""!==t)for(var i=0;i<this.nodes.length;i++)this.nodes[i].setAttribute(t,e)}else if(1===arguments.length)if(r.isObject(t))for(var o=0;o<this.nodes.length;o++)for(var i in t)""!==i&&this.nodes[o].setAttribute(i,t[i]);else t&&(n=this.nodes[0].getAttribute(t));return n},g.prototype.removeAttr=function(t){for(var e=0;e<this.nodes.length;e++)this.nodes[e].removeAttribute(t);return this},g.prototype.data=function(t,n){var i=null;if(!this.isEmpty())if(1===arguments.length)this.nodes[0].datasets||(this.nodes[0].datasets={}),r.isString(t)?void 0!==this.nodes[0].datasets[t]&&null!==this.nodes[0].datasets[t]&&(i=this.nodes[0].datasets[t]):r.isObject(t)&&e.extend(this.nodes[0].datasets,t);else if(2===arguments.length){this.addClass("incache");for(var o=0;o<this.nodes.length;o++)this.nodes[o].datasets||(this.nodes[o].datasets={}),this.nodes[o].datasets[t]=n;i=this}return i},g.prototype.removeData=function(t){return this.isEmpty()||1===arguments.length&&this.data(t,null),this},g.prototype.dataset=function(t,e){var n=this;if(this.nodes.length>0)if(1===arguments.length){if(r.isString(t))n=this.nodes[0].dataset?this.nodes[0].dataset[t]:this.nodes[0].getAttribute(l.getDatasetName(t));else if(r.isObject(t))for(var i in t)this.nodes[0].dataset?this.nodes[0].dataset[i]=t[i]:this.nodes[0].setAttribute(l.getDatasetName(i),t[i])}else if(2===arguments.length)for(var i=0;i<this.nodes.length;i++)this.nodes[0].dataset?this.nodes[i].dataset[t]=e:this.nodes[0].setAttribute(l.getDatasetName(t),e);else if(0===arguments.length)if(this.nodes[0].dataset)n=this.nodes[0].dataset;else{var o=this.nodes[0].attrbutes;n={};for(var i=0;i<o.length;o++)0===o[i].nodeName.indexOf("data-")&&(n[l.getDatasetReserve(o[i].nodeName)]=o[i].nodeValue)}return n},g.prototype.create=function(t,e){return t?e?this.nodes=[window.document.createElementNS(e,t)]:this.nodes=[window.document.createElement(t)]:this.nodes=[window.document.createDocumentFragment()],this.length=this.nodes.length,this},g.prototype.element=function(t,e){return t?e?this.nodes=[window.document.createElementNS(e,t)]:this.nodes=[window.document.createElement(t)]:this.nodes=[window.document.createDocumentFragment()],this.length=this.nodes.length,this},g.prototype.width=function(t){return 1===arguments.length?(r.isNumber(t)&&(t+="px"),this.css("width",t),this):this.nodes[0].offsetWidth},g.prototype.height=function(t){return 1===arguments.length?(r.isNumber(t)&&(t+="px"),this.css("height",t),this):this.nodes[0].offsetHeight},g.prototype.offset=function(){if(this.isEmpty())return null;var t=this.nodes[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:t.width,height:t.height}},g.prototype.hide=function(){for(var t=0;t<this.nodes.length;t++){var e=window.getComputedStyle(this.nodes[t],"").getPropertyValue("display");"none"!==e&&(this.nodes[t].setAttribute("ds",e),this.nodes[t].style.display="none")}return this},g.prototype.show=function(){for(var t=0;t<this.nodes.length;t++){var e=window.getComputedStyle(this.nodes[t],"").getPropertyValue("display");if("none"===e){var n=this.nodes[t].getAttribute("ds");n?(this.nodes[t].removeAttribute("ds"),this.nodes[t].style.display=n):this.nodes[t].style.display="block"}}return this},g.prototype.visible=function(t){for(var e=0;e<this.nodes.length;e++)t?this.nodes[e].style.visibility="visible":this.nodes[e].style.visibility="hidden";return this},g.prototype.html=function(t){var e=this;if(!this.isEmpty())if(1===arguments.length)for(var n=0;n<this.nodes.length;n++)this.nodes[n].innerHTML=t;else e=this.nodes[0].innerHTML;return e},g.prototype.outer=function(){return this.isEmpty()?"":this.nodes[0].outerHTML},g.prototype.text=function(t){var e=this;if(!this.isEmpty())if(1===arguments.length)for(var n=0;n<this.nodes.length;n++)this.nodes[n].innerText=t;else e=this.nodes[0].innerText;return e},g.prototype.val=function(t){var e=this;if(!this.isEmpty())if(1===arguments.length)for(var n=0;n<this.nodes.length;n++)this.nodes[n].value=t;else e=this.nodes[0].value;return e},g.prototype.addClass=function(t){for(var e=0;e<this.nodes.length;e++)this.nodes[e].classList?this.nodes[e].classList.add(t):-1===this.nodes[e].className.indexOf(t)&&(this.nodes[e].className=this.nodes[e].className+" "+t);return this},g.prototype.removeClass=function(t){for(var e=0;e<this.nodes.length;e++)if(this.nodes[e].classList)this.nodes[e].classList.remove(t);else if(-1!==this.nodes[e].className.indexOf(t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");this.nodes[e].className=this.nodes[e].className.replace(n," ")}return this},g.prototype.contains=function(t){if(!this.isEmpty()){var n=e(t);if(!n.isEmpty())return this.nodes[0].contains(n.nodes[0])}return!1},g.prototype.contain=function(t){return this.same(t)||this.contains(t)},g.prototype.hasClass=function(t){var e=!1;return this.isEmpty()||(e=this.nodes[0].classList?this.nodes[0].classList.contains(t):-1===this.nodes[0].className.indexOf(t)),e},g.prototype.toggleClass=function(t){if(!this.isEmpty())if(this.nodes[0].classList)this.nodes[0].classList.toggle(t);else if(-1!==this.nodes[0].className.indexOf(t))for(var e=new RegExp("(\\s|^)"+t+"(\\s|$)"),n=0;n<this.nodes.length;n++)this.nodes[n].className=this.nodes[n].className.replace(e," ");else for(var n=0;n<this.nodes.length;n++)this.nodes[n].className=this.nodes[n].className+" "+t;return this},g.prototype.scrollTop=function(t){var e=this;if(0===arguments.length)e=this.isEmpty()?null:void 0!==this.nodes[0].scrollTop?this.nodes[0].scrollTop:this.nodes[0].scrollY;else for(var n=0;n<this.nodes.length;n++)void 0!==this.nodes[n].scrollTop?this.nodes[n].scrollTop=t:this.nodes[n].scrollY=t;return e},g.prototype.scrollLeft=function(t){var e=this;if(0===arguments.length)e=this.isEmpty()?null:void 0!==this.nodes[0].scrollLeft?this.nodes[0].scrollLeft:this.nodes[0].scrollX;else for(var n=0;n<this.nodes.length;n++)void 0!==this.nodes[n].scrollLeft?this.nodes[n].scrollLeft=t:this.nodes[n].scrollX=t;return e},g.prototype.click=function(t){return 1===arguments.length?this.bind("click",t):this.trigger("click"),this},g.prototype.load=function(t){return 1===arguments.length?this.bind("load",t):this.trigger("load"),this},g.prototype.trigger=function(t,e){return m.util.trigger(this,t,e)},g.prototype.bind=function(t,e,n){if(r.isString(t))return m.util.bind(this,t,e,n);if(r.isArray(t)){for(var i=0;i<t.length;i++)m.util.bind(this,t[i],e,n);return this}},g.prototype.unbind=function(t,e){return m.util.unbind(this,t,e)},g.prototype.isEmpty=function(t){return 0===arguments.length?0===this.nodes.length:r.isFunction(t)?(t.call(this,0===this.nodes.length),this):this},g.prototype.isWrapper=function(){return this instanceof g},g.prototype.add=function(t){var n=e(t);return this.nodes=this.nodes.concat(n.nodes),this.length=this.nodes.length,this},g.prototype.prop=function(t,e){for(var n=0;n<this.nodes.length;n++){var i=this.nodes[n][t];void 0!==i&&(r.isFunction(e)?this.nodes[n][t]=e.call(this.nodes[n],n,i):this.nodes[n][t]=e)}return this},g.prototype.position=function(t,e){if(0===arguments.length){var t=this.offsetParent();return t.length>0&&!r.isDocument(t.get(0))?{left:this.css("left"),top:this.css("top")}:this.offset()}return t&&this.css("left",t),e&&this.css("top",e),this},g.prototype.offsetParent=function(){var t=[];if(!this.isEmpty())if(void 0===this.nodes[0].offsetParent){for(var e=this.nodes[0].parentNode;e&&!h.regs.root.test(e.nodeName)&&"static"===window.getComputedStyle(e,"").getPropertyValue("position");)e=e.parentNode;t.push(e)}else t.push(this.nodes[0].offsetParent);return h.util.getDom(t)},g.prototype.scrollingLeft=function(t,n,r){var i=e.promise().scope(this),o=this;return this.scrollLeft()!==t?new _({from:this.scrollLeft(),to:t,during:n,fn:r,onrunning:function(t){o.scrollLeft(t)},onend:function(){i.resolve()}}).start():i.resolve(),i},g.prototype.scrollingTop=function(t,n,r){var i=e.promise().scope(this),o=this;return this.scrollTop()!==t?new _({from:this.scrollTop(),to:t,during:n,fn:r,onrunning:function(t){o.scrollTop(t)},onend:function(){i.resolve()}}).start():i.resolve(),i},g.prototype.transition=function(){var t=this.data("_transition_");return t||(t=new d(this)),t},g.prototype.animate=function(t,n){var r=this,i=this.data("_animate_"),o={duration:350,delay:0,type:"ease-out"};e.extend(o,n),t=s.fix(t);var a="";for(var l in t)a+=l+" "+o.duration+"ms "+o.type+" "+o.delay+"ms,";if(a.length>0&&(a=a.substring(0,a.length-1)),i)i.then(function(){var n=e.promise().scope(r),i=function(t){r.get(0).removeEventListener(s.transitionEnd,i,!1),n.resolve(t)};return r.css(s.prefix+"transition",a).get(0).addEventListener(s.transitionEnd,i,!1),r.css(t),n},function(t){return console.error(t),t});else{var u=e.promise().scope(r),c=function(t){r.get(0).removeEventListener(s.transitionEnd,c,!1),u.resolve(t)};r.css(s.prefix+"transition",a).get(0).addEventListener(s.transitionEnd,c,!1),r.css(t),r.data("_animate_",u),i=u}return i},g.prototype.transform=function(){var t=this.data("_transform_");return t||(t=new f(this)),t},g.prototype.isRemoved=function(){return this.nodes[0]?!window.document.contains(this.nodes[0]):!1},g.prototype.mutationObserve=function(t,e){if(!this.isEmpty()&&!this.nodes[0].datasets["-mutation-"]){var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,r=new n(t);r.observe(this.nodes[0],e),this.nodes[0].datasets["-mutation-"]=r}return this},g.prototype.unMutationObserve=function(){return this.isEmpty()||this.nodes[0].datasets["-mutation-"]&&(this.nodes[0].datasets["-mutation-"].disconnect(),this.nodes[0].datasets["-mutation-"].takeRecord(),this.nodes[0].datasets["-mutation-"]=null),this},g.prototype.finder=function(){return this.isEmpty()?null:this.nodes[0].datasets&&this.nodes[0].datasets["-finder-"]?this.nodes[0].datasets["-finder-"]:null},g.prototype.group=function(){var t=[];if(!this.isEmpty())for(var n=this.node[0].parentNode;n&&n!==document;){if(e(n).dataset("group")){t.push(n);break}n=n.parentNode}return h.util.getDom(t)},g.prototype.items=function(t){var e=[];return this.isEmpty()||(e=h.util.query(this.nodes[0],"[data-groupi='"+t+"']")),h.util.getDom(e)},g.prototype.cache=function(){if(this.isEmpty())return null;for(var t=this.nodes[0],e=this.dataset("cache"),n=!1;t&&t!==window.document;){if(t.datasets&&t.datasets["--cache--"]&&void 0!==t.datasets["--cache--"][e]){n=!0;break}t=t.parentNode}return n?t.datasets["--cache--"][e]:null},g.prototype.getModule=function(){return this.data("--view--")},g.prototype.predefined=function(t){var e=Array.prototype.slice.call(arguments),n=g.prototype[e[0]];return n?(e.splice(0,1),n.call(this,e)):this},g.prototype.delegate=function(t,n,r){this.bind(t,function(t){for(var i=t.target,o=t.currentTarget,s=h.util.queryChildAll(e(this).get(0),n);i!==o&&i!==window.document;){if(-1!==s.indexOf(i)){if(t._ispropagation)break;if(t.stopPropagation=function(){this._ispropagation=!0,Object.getPrototypeOf(t).stopPropagation.call(this)},r&&r.call(i,t),t._ispropagation)break}i=i.parentNode}})},h.prototype=new g;var v=function(t){this.obj=t};v.prototype.width=function(){return window.innerWidth},v.prototype.height=function(){return window.innerHeight},v.prototype.bind=function(t,e,n){return r.isWindow(this.obj)?(n||(n=!1),window.addEventListener(t,e,n)):(this.nodes=[this.obj],m.util.bind(this,t,e,n)),this},v.prototype.unbind=function(t,e){return r.isWindow(this.obj)?window.removeEventListener(t,e,!1):(this.nodes=[this.obj],m.util.bind(this,t,e)),this},v.prototype.scrollTop=function(t){var e=this;return 0===arguments.length?e=document.body.scrollTop||document.documentElement.scrollTop:(document.body.scrollTop=t,document.documentElement.scrollTop=t),e},v.prototype.scrollLeft=function(t){var e=this;return 0===arguments.length?e=document.body.scrollLeft||document.documentElement.scrollLeft:document.body.scrollLeft=t,e},v.prototype.scrollingLeft=function(t,n,r){var i=e.promise().scope(this),o=this;return this.scrollLeft()!==t?new _({from:this.scrollLeft(),to:t,during:n,fn:r,onrunning:function(t){o.scrollLeft(t)},onend:function(){i.resolve()}}).start():i.resolve(),i},v.prototype.scrollingTop=function(t,n,r){var i=e.promise().scope(this),o=this;return this.scrollTop()!==t?new _({from:this.scrollTop(),to:t,during:n,fn:r,onrunning:function(t){o.scrollTop(t)},onend:function(){i.resolve()}}).start():i.resolve(),i};var m=function(t){this.currentTarget=null,this.target=null,this.timeStamp=(new Date).getTime(),this.type="",this.cancelable=!1,this._stop=!1,this.data=t};m.prototype.stopPropagation=function(){this._stop=!0},m.prototype.preventDefault=function(){this.cancelable=!0},m.trigger=function(t){var e=t.currentTarget.events[t.type];for(var n in e)e[n].call(t.currentTarget,t)},m.util={types:{HTMLEvents:"load,unload,abort,error,select,change,submit,reset,focus,blur,resize,scroll",MouseEvent:"click,mousedown,mouseup,mouseover,mousemove,mouseout",UIEvent:"DOMFocusIn,DOMFocusOut,DOMActivate",MutationEvent:"DOMSubtreeModified,DOMNodeInserted,DOMNodeRemoved,DOMNodeRemovedFromDocument,DOMNodeInsertedIntoDocument,DOMAttrModified,DOMCharacterDataModified"},unbubbling:["unload","abort","error","scroll","focus","blur","DOMNodeRemovedFromDocument","DOMNodeInsertedIntoDocument","progress","load","loadend","pointerenter","pointerleave","rowexit","stop","finish","bounce","afterprint","propertychange","filterchange","readystatechange","losecapture","dragdrop","dragenter","dragexit","draggesture","dragover","RadioStateChange","close","command","contextmenu","overflow","overflowchanged","underflow","popuphidden","popuphiding","popupshowing","popupshown","commandupdate"],isEvent:function(t){var e={type:t,interfaceName:null};for(var n in m.util.types)if(-1!==m.util.types[n].indexOf(t)){e.interfaceName=n;break}return e},bind:function(t,e,n,r){r||(r=!1);for(var i=0;i<t.nodes.length;i++)t.nodes[i].events||(t.nodes[i].events={}),t.nodes[i].events[e]?t.nodes[i].events[e].push(n):(t.nodes[i].events[e]=[],t.nodes[i].events[e].push(n)),t.nodes[i].addEventListener(e,m.trigger,r);return t},unbind:function(t,e,n){for(var i=0;i<t.nodes.length;i++){var o=t.nodes[i];if(o.events)if(e&&""!==e){var s=o.events[e];if(s)if(o.removeEventListener(e,m.trigger,!1),r.isFunction(n))for(var i in s)s[i]===n&&s.splice(i,1);else s.length=0}else{var a=o.events;for(var i in a)o.removeEventListener(i,m.trigger,!1),a[i].length=0}}return t},unbindAll:function(t){for(var e=t.nodes,n=0;n<e.length;n++){var r=e[n].events;for(var i in r)e[n].removeEventListener(i,m.trigger,!1),r[i].length=0}return t},unbindnode:function(t){var e=t.events;for(var n in e)t.removeEventListener(n,m.trigger,!1),e[n].length=0},trigger:function(t,e,n){var r=this.isEvent(e);if(r.interfaceName){var i=document.createEvent(r.interfaceName);switch(r.interfaceName){case"MouseEvent":i.initMouseEvent(e,!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);break;case"HTMLEvents":i.initEvent(e,!0,!1,window);break;case"UIEvents":i.initUIEvents(e,!0,!1,window,null);break;case"MutationEvent ":i.initMutationEvent(e,!0,!1,window,null,null,null,null)}for(var o=0;o<t.nodes.length;o++)t.nodes[o].dispatchEvent(i)}else{var s=new m(n);s.type=e,s.target=t.nodes[0];for(var a=t.nodes[0];a;){if(s.currentTarget=a,a.events&&a.events[e]){var l=a.events[e];for(var o in l)l[o].call(a,s)}if(s._stop)break;a=a.parentNode}}return t},canBubbleUp:function(t){return-1===m.util.unbubbling.indexOf(t)}};var y={linner:function(t,e,n,r){return n*t/r+e},"ease-in-quad":function(t,e,n,r){return n*(t/=r)*t+e},"ease-out-quad":function(t,e,n,r){return-n*(t/=r)*(t-2)+e},"ease-in-out-quad":function(t,e,n,r){return(t/=r/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},"ease-in-cubic":function(t,e,n,r){return n*(t/=r)*t*t+e},"ease-out-cubic":function(t,e,n,r){return n*((t=t/r-1)*t*t+1)+e},"ease-in-out-cubic":function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},"ease-in-quart":function(t,e,n,r){return n*(t/=r)*t*t*t+e},"ease-out-quart":function(t,e,n,r){return-n*((t=t/r-1)*t*t*t-1)+e},"ease-in-out-quart":function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},"ease-in-quint":function(t,e,n,r){return n*(t/=r)*t*t*t*t+e},"ease-out-quint":function(t,e,n,r){return n*((t=t/r-1)*t*t*t*t+1)+e},"ease-in-out-quint":function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},"ease-in-sine":function(t,e,n,r){return-n*Math.cos(t/r*(Math.PI/2))+n+e},"ease-out-sine":function(t,e,n,r){return n*Math.sin(t/r*(Math.PI/2))+e},"ease-in-out-sine":function(t,e,n,r){return-n/2*(Math.cos(Math.PI*t/r)-1)+e},"ease-in-expo":function(t,e,n,r){return 0===t?e:n*Math.pow(2,10*(t/r-1))+e},"ease-out-expo":function(t,e,n,r){return t===r?e+n:n*(-Math.pow(2,-10*t/r)+1)+e},"ease-in-out-expo":function(t,e,n,r){return 0===t?e:t===r?e+n:(t/=r/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(-Math.pow(2,-10*--t)+2)+e},"ease-in-circ":function(t,e,n,r){return-n*(Math.sqrt(1-(t/=r)*t)-1)+e},"ease-out-circ":function(t,e,n,r){return n*Math.sqrt(1-(t=t/r-1)*t)+e},"ease-in-out-circ":function(t,e,n,r){return(t/=r/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},"ease-in-elastic":function(t,e,n,r,i,o){var s;return 0===t?e:1==(t/=r)?e+n:("undefined"==typeof o&&(o=.3*r),!i||i<Math.abs(n)?(s=o/4,i=n):s=o/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o))+e)},"ease-out-elastic":function(t,e,n,r,i,o){var s;return 0===t?e:1===(t/=r)?e+n:("undefined"==typeof o&&(o=.3*r),!i||i<Math.abs(n)?(i=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*t)*Math.sin((t*r-s)*(2*Math.PI)/o)+n+e)},"ease-in-out-elastic":function(t,e,n,r,i,o){var s;return 0===t?e:2===(t/=r/2)?e+n:("undefined"==typeof o&&(o=r*(.3*1.5)),!i||i<Math.abs(n)?(i=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/i),1>t?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o))+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*r-s)*(2*Math.PI)/o)*.5+n+e)},"ease-in-back":function(t,e,n,r,i){return"undefined"==typeof i&&(i=1.70158),n*(t/=r)*t*((i+1)*t-i)+e},"ease-out-back":function(t,e,n,r,i){return"undefined"==typeof i&&(i=1.70158),n*((t=t/r-1)*t*((i+1)*t+i)+1)+e},"ease-in-out-back":function(t,e,n,r,i){return"undefined"==typeof i&&(i=1.70158),(t/=r/2)<1?n/2*(t*t*(((i*=1.525)+1)*t-i))+e:n/2*((t-=2)*t*(((i*=1.525)+1)*t+i)+2)+e},"ease-in-bounce":function(t,e,n,r){return n-y["ease-out-bounce"](r-t,0,n,r)+e},"ease-out-bounce":function(t,e,n,r){return(t/=r)<1/2.75?n*(7.5625*t*t)+e:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},"ease-in-out-bounce":function(t,e,n,r){return r/2>t?.5*y["ease-in-bounce"](2*t,0,n,r)+e:.5*y["ease-out-bounce"](2*t-r,0,n,r)+.5*n+e}},_=function(t){this.from=r.isAvalid(t.from)?t.from:0,this.to=r.isAvalid(t.to)?t.to:100,r.isString(t.fn)?this.fn=y[t.type]||y["ease-out-quart"]:r.isFunction(t.fn)?this.fn=t.fn:this.fn=y["ease-out-quart"],this.during=Math.round((t.during||1e3)/16.7),this.onrunning=t.onrunning,this.onend=t.onend,this.delay=r.isAvalid(t.delay)?t.delay:0,this.isstop=!0};_._run=function(){var t=0,e=this.during,n=this.to-this.from,r=this,i=function(){t++,r.onrunning&&r.onrunning.call(r,r.fn(t,r.from,n,e)),e>t&&!r.isstop?requestAnimationFrame(i):(r.onend&&r.onend.call(r),r.isstop=!0)};i()},_._runs=function(){for(var t=0,e=this.during,n=[],r=this,i=0;i<this.from.length;i++)n.push(this.to[i]||0-this.from[i]);var o=function(){t++;for(var i=[],s=0;s<r.from.length;s++)i.push(r.fn(t,r.from[s],n[s],e));r.onrunning&&r.onrunning.call(r,i),e>t&&!r.isstop?requestAnimationFrame(o):(r.onend&&r.onend.call(r),r.isstop=!0)};o()},_._runo=function(){var t=0,e=this.during,n={},r=this;for(var i in this.from)n[i]=this.to[i]||0-this.from[i];var o=function(){t++;var i={};for(var s in r.from)i[s]=r.fn(t,r.from[s],n[s],e);r.onrunning&&r.onrunning.call(r,i),e>t&&!r.isstop?requestAnimationFrame(o):(r.onend&&r.onend.call(r),r.isstop=!0)};o()},_.prototype.start=function(){var t=this;return this.isstop=!1,setTimeout(function(){r.isArray(t.from)?_._runs.call(t):r.isObject(t.from)?_._runo.call(t):r.isNumber(t.from)&&_._run.call(t)},this.delay),this},_.prototype.stop=function(){return this.isstop=!0,this},_.prototype.isRunning=function(){return this.isstop===!0},_.prototype.clean=function(){for(var t in this)this[t]=null},e.tween=function(t){return new _(t)};var w=function(t){this.mimeType=null,this.data=t.data||"",this.url=t.url||"",this.realURL=t.url||"",this.method=t.method||"post",this.realType=t.dataType||"text",this.download=t.download||!1,this.dataType=-1!==["arraybuffer","blob","document","text"].indexOf(t.dataType)?t.dataType:"text",this.async=t.async===!1?!1:!0,this.timeout=t.timeout||3e6,this.headers=t.headers||{},this.events=e.extend({readystatechange:null,loadstart:null,progress:null,abort:null,error:null,load:null,timeout:null,loadend:null},t.events);var n=this;this._eventproxy=function(t){var e=n.events[t.type];n.response=this,e&&e.call(n,t),"loadend"===t.type&&n.clean()},this._uploadproxy=function(t){var e=n.events[t.type];n.response=this,e&&e.call(n,t)},this.xhr=new XMLHttpRequest};w.prototype.clean=function(){for(var t in this.events)"progress"===t?this.download===!0?this.xhr.removeEventListener(t,this._uploadproxy,!1):this.xhr.upload.removeEventListener(t,this._uploadproxy,!1):this.xhr.removeEventListener(t,this._eventproxy,!1);for(var t in this)this[t]=null},w.prototype.abort=function(){return this.xhr.abort(),this},w.prototype.header=function(t,e){if(1===arguments.length)for(var n in t)this.headers[n]=t[n];else this.headers[t]=e;return this},w.prototype.bind=function(t,e){if(1===arguments.length)for(var n in t)this.events[n]=t[n];else this.events[t]=e;return this},w.prototype.unbind=function(t,e){var n=this.events[t];for(var r in n)n[r]===e&&(n[r]=null);return this},w.prototype.fire=function(){if(this.mimeType&&this.xhr.overrideMimeType(this.mimeType),"get"===this.method){var t=i.queryString(this.data);this.url+=-1!==this.url.indexOf("?")?""===t?"":"&"+t:""===t?"":"?"+t}else this.data=i.postData(this.data);this.xhr.open(this.method,this.url,this.async),this.async&&(this.xhr.responseType=this.dataType,this.xhr.timeout=this.timeout);for(var e in this.events)"progress"===e?this.download===!0?this.xhr.addEventListener(e,this._uploadproxy,!1):this.xhr.upload.addEventListener(e,this._uploadproxy,!1):this.xhr.addEventListener(e,this._eventproxy,!1);this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");for(var e in this.headers)this.xhr.setRequestHeader(e,this.headers[e]);return r.isQueryString(this.data)&&this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.send(this.data),this},e.ajax=function(t){var n=new p;return t?(t.events=e.extend({error:function(e){t.error&&t.error.call(this,e),n.reject(e)},load:function(e){var r=this.response.status;if(r>=200&&300>r||304===r||0===r){var i=this.response.response;if("json"===this.realType){var s=this.response.responseText;try{i=o.parse(s)}catch(e){throw Error("[topolr] ajax unvaliable json string,url is '"+t.url+"' "+e)}}t.success&&t.success.call(this,i),n.resolve(i)}else t.error&&t.error.call(this,e),n.reject(this.response)}},t.events),new w(t).fire(),n):n.resolve()},e.request=function(t){return new w(t)};var k={importsmapping:{js:[],css:[],hasJs:function(t){return-1!==this.js.indexOf(t)?!0:!1},hasCss:function(t){return-1!==this.css.indexOf(t)?!0:!1},addJs:function(t){return this.js.push(t),this},addCss:function(t){return this.css.push(t),this}},css:function(t,e,n){if(k.importsmapping.hasCss(t))e&&e();else{var r=document.createElement("link"),i=null;r.href=t,r.type="text/css",r.rel="stylesheet";var o=function(t){r.removeEventListener("error",o),r.removeEventListener("load",s),n&&n.call(t.target,t)},s=function(t){r.removeEventListener("error",o),r.removeEventListener("load",s),e&&(clearTimeout(i),e.call(t.target,t))};r.addEventListener("error",o,!1),r.addEventListener("load",s,!1),document.getElementsByTagName("head")[0].appendChild(r),k.importsmapping.addCss(t);var a=function(){try{r.sheet.cssRules&&r.sheet.cssRules.length>0&&(r.removeEventListener("error",o),r.removeEventListener("load",s),e&&e.call(r))}catch(t){i=setTimeout(a,100)}};a()}return this},js:function(t,e,n,r){if(k.importsmapping.hasJs(t))e&&e();else{var i=function(t){t.target.removeEventListener("load",i),t.target.removeEventListener("error",o),e&&e.call(t.target,t)},o=function(t){t.target.removeEventListener("load",i),t.target.removeEventListener("error",o),n&&n.call(t.target,t)},s=document.createElement("script");s.src=t,s.type="text/javascript";for(var a in r)s[a]=r[a];s.addEventListener("load",i,!1),s.addEventListener("error",o,!1),document.getElementsByTagName("head")[0].appendChild(s),k.importsmapping.addJs(t)}return this},image:function(t,e,n){var r=document.createElement("img"),i=function(t){t.target.removeEventListener("load",i),t.target.removeEventListener("error",o),e&&e.call(t.target,t)},o=function(t){t.target.removeEventListener("load",i),t.target.removeEventListener("error",o),n&&n.call(t.target,t)};return r.src=t,r.addEventListener("load",i,!1),r.addEventListener("error",o,!1),this},load:function(t,e,n,r){if(t){var i=new u;for(var o in t)for(var s in t[o])i.add(function(t,e){var n=this;k[e.type](e.path,function(t){n.next()},function(t){r&&r.call(n,e.type,e.path)})},null,{type:o,path:t[o][s]});i.complete(function(){e&&e()}).progress(function(t){n&&n({total:t.total,runed:t.runed,progress:Math.floor(t.runed/t.total*100)})}).run()}else e&&e()}};e.loader=function(){return k};var x={_ready:null,_done:!1,_browser:!0,option:{debug:!0,sitePath:"",basePath:"",title:"",keywords:"",description:"",boot:""}},N={boot:function(n){if(!x._done){var r=x.option.boot,i=e.promise();return e().ready(function(){x.option.debug&&x.option.map&&e("body").dataset("builterId",x.option.map.id),n||e("body").html(""),N.setInfo(),x.option.debug&&console.log("[topolr] version:"+t.version+",debug:"+x.option.debug+",basePath:"+x.option.basePath);try{x._ready&&x._ready()}catch(o){console.error(o)}O.init(x.option).done(function(){var t=e("body");t.length>0?(e.is.isString(r)?(t.dataset("view","root").dataset("viewId","root").dataset("option",r),r={}):t.dataset("view","root").dataset("viewId","root").dataset("option",""),L.getViewInstance(t,r,function(t){O.root=t,t.privator("render",function(){x._done=!0,i.resolve()})})):(console.error("[topolr boot] can not find the root element."),
i.reject())})}),i}},ready:function(t){return x._ready=t,this},snapshot:function(){return window.pageComplete&&window.pageComplete(),this},getRoot:function(){return this.source.root},setSitePath:function(t){return x._done||t&&(x.option.sitePath=t,"/"!==x.option.sitePath[x.option.sitePath.length-1]&&(x.option.sitePath=x.option.sitePath+"/"),x.option.basePath=(x.option.sitePath||"")+x.option.basePath),this},setInfo:function(t){t&&e.extend(x.option,{title:t.title||"",keywords:t.keywords||"",description:t.description||""}),e("title").html(x.option.title);var n=!1,r=!1;return e("meta").each(function(){"keywords"===e(this).attr("name")&&(e(this).attr("content",x.option.keywords),n=!0),"description"===e(this).attr("name")&&(e(this).attr("content",x.option.description),n=!0)}),n||e("<meta name='keywords' content='"+x.option.keywords+"'>").appendTo("head"),r||e("<meta name='description' content='"+x.option.description+"'>").appendTo("head"),this},setTitle:function(t){return x.option.title=t,e("title").html(x.option.title),this},isBrowser:function(){return x._browser},isReady:function(){return x._done},getOption:function(){return e.extend(!0,{},x.option)}};e.app=function(t){return!x._done&&t&&(t.sitePath&&"/"!==t.sitePath[t.sitePath.length-1]&&(t.sitePath=t.sitePath+"/"),t.basePath=(t.sitePath||"")+t.basePath,e.extend(x.option,t)),N};var O={basePath:"",debug:!1,ready:!1,sourceType:{packet:"js-text-content-text-p",template:"html-text-template-text-t",html:"html-text-html-text-h",js:"js-code-code-js-j",css:"css-code-css-css-c",json:"json-text-content-json-s",image:"png-nothing-code-image-i",text:"html-text-content-text-n",style:"css-code-css-text-y"},sourceTypeAlias:{},current:{map:{},getPacketPath:function(t,e){e||(e="packet");var n=O.sourceTypeAlias[e],r=!0,i=O.current.map.c,o="";for(var s in i){var a=i[s];if(a[n]&&-1!==a[n].indexOf(t)){for(var l=0,u=0;u<a[n].length;u++){var c=a[n][u],p=O.current.map.m[n]?O.current.map.m[n][c]:null,h=O.local[e]&&O.local[e][c]?O.local[e][c].hash:"";p!==h&&l++}l>2&&(o=O.basePath+s+".js");break}}return o||(r=!1,o=O.getPacketPath(t,e)),{compress:r,path:o+(O.debug?"?t="+(new Date).getTime():"")}},get:function(t,e){e||(e="packet");var n=O.sourceTypeAlias[e];return O.current.map.m&&O.current.map.m[n]?O.current.map.m[n][t]:null}},local:{},root:null,persister:null,init:function(t){O.current.map=t.map||{d:!1},O.debug=O.current.map.d,O.basePath=t.basePath;for(var n in O.sourceType)O.sourceTypeAlias[n]=O.sourceType[n].split("-").pop();if(!O.debug&&t.map){var r=O.persist.checkPersist();"database"===r?O.persister=O.persist.database:"storage"===r?O.persister=O.persist.storage:O.persister=O.persist.empty}else O.persister=O.persist.empty;return O.persister.getAll().then(function(t){O.ready=!0,O.appender.appendInit(),O.local=e.extend({},t,O.local)},function(t){return console.error(t),t})},get:function(t,e){e||(e="packet");var n=O.getProcessor(e),r=n.loader,i=n.trigger,o=n.parser,s=O.local[e]?O.local[e][t]:null;if(s){var a=O.current.get(t,e);if(!a||s.hash===a)return O.trigger[i](s.content,t)}var l=O.current.getPacketPath(t,e),u=l.path;return l.compress?(O.root&&O.root.dispatchEvent("sourceload",{type:"full",path:u}),O.loader.compress(u).then(function(n){O.root&&O.root.dispatchEvent("sourceloaded",{type:"full",path:u});for(var r in n)for(var o=r,s=n[r],a=0;a<s.length;a++){var l=s[a],c=O.getProcessor(o).parser,p=O.parser[c](O.getPacketPath(l.p,o),l.c);O.local[o]||(O.local[o]={}),O.local[o][l.p]={hash:l.h,content:p}}O.persister.saveAll(O.local);var h=O.local[e][t];if(h)return O.trigger[i](h.content,t);throw Error("[topolr] packet can not find name is "+t)},function(t){return console.error(t),t})):(O.root&&O.root.dispatchEvent("sourceload",{type:"slice",path:u}),O.loader[r](u).then(function(n){return O.root&&O.root.dispatchEvent("sourceloaded",{type:"slice",path:u}),n=O.parser[o](u,n),O.local[e]||(O.local[e]={}),O.local[e][t]={hash:O.current.get(t,e),content:n},O.persister.saveAll(O.local),O.trigger[i](n,t)},function(e){return console.error("[topolr] packet can not find name is "+t),e}))},getPacketName:function(t){return t.substring(O.basePath.length).split(".")[0].replace(/\//g,".")},getProcessor:function(t){var e="nothing",n="text",r="content";if(O.sourceType[t]){var i=O.sourceType[t].split("-");e=i[1],r=i[2],n=i[3]}return{loader:e,parser:r,trigger:n}},getPacketPath:function(t,e){var n=O.current.get(t,e),r="",i=t.split(/\[|\]/),t=i[0],o=i[1];if(o||(o=O.sourceType[e]?O.sourceType[e].split("-")[0]:"html"),null!==n&&void 0!==n)if(O.debug)r=O.basePath+t.replace(/\./g,"/")+"."+o+"?h="+n;else{var s=t.split(".");s.pop(),r=O.basePath+s.join("/")+"/"+n+"."+o}else r=O.basePath+t.replace(/\./g,"/")+"."+o;return r},persist:{checkPersist:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB?"database":window.localStorage?"storage":null},empty:{getAll:function(){return e.promise(function(t){t({})})},saveAll:function(){return e.promise(function(t){t()})},clean:function(){return e.promise(function(t){t()})}},storage:{getAll:function(){var t={};try{t=window.localStorage.getItem("topolr-local-source")}catch(n){}return e.promise(function(e){e(t)})},saveAll:function(t){try{window.localStorage.setItem("topolr-local-source",window.JSON.stringify(t))}catch(n){}return e.promise(function(t){t()})},clean:function(){try{window.localStorage.removeItem("topolr-local-source")}catch(t){}return e.promise(function(t){t()})}},database:{db:null,info:{name:"topolr",version:1,store:"topolr-local-source",key:"name",value:"local"},init:function(){var t=e.promise();window.indexedDB||(window.indexedDB=window.mozIndexedDB||window.webkitIndexedDB);var n=indexedDB.open(O.persist.database.info.name,O.persist.database.info.version);return n.onupgradeneeded=function(t){var e=n.result;e.objectStoreNames.contains(O.persist.database.info.store)&&e.deleteObjectStore(O.persist.database.info.store);var r=e.createObjectStore(O.persist.database.info.store,{keyPath:O.persist.database.info.key});r.put({name:O.persist.database.info.value,data:{}})},n.onsuccess=function(e){O.persist.database.db=n.result,t.resolve()},n.onerror=function(){t.resolve()},t},getAll:function(){var t=function(){var t=e.promise();if(O.persist.database.db){var n=O.persist.database.db.transaction([O.persist.database.info.store],"readwrite");n.onerror=function(e){t.resolve({})};var r=n.objectStore(O.persist.database.info.store).get(O.persist.database.info.value);r.onerror=function(e){t.resolve({})},r.onsuccess=function(e){t.resolve(r.result?r.result.data:{})}}else t.resolve({});return t};return O.persist.database.db?t():O.persist.database.init().then(function(){return t()},function(t){return console.error(t),t})},saveAll:function(t){var n=function(){var n=e.promise();if(O.persist.database.db){var r=O.persist.database.db.transaction([O.persist.database.info.store],"readwrite");r.oncomplete=function(t){n.resolve()},r.onerror=function(t){n.resolve()},r.objectStore(O.persist.database.info.store).put({name:O.persist.database.info.value,data:t})}else n.resolve();return n};return O.persist.database.db?n():O.persist.database.init().then(function(){return n()},function(t){return console.error(t),t})},clean:function(){var t=function(){var t=e.promise();if(O.persist.database.db){var n=O.persist.database.db.transaction([O.persist.database.info.store],"readwrite");n.oncomplete=function(e){t.resolve()},n.onerror=function(e){t.resolve()},n.objectStore(O.persist.database.info.store)["delete"](O.persist.database.info.value)}else t.resolve();return t};return O.persist.database.db?t():O.persist.database.init().then(function(){return t()},function(t){return console.error(t),t})}}},loader:{compress:function(t){return e.ajax({url:t,method:"get",dataType:"text"}).then(function(t){return JSON.parse(t.substring(21,t.length-2))},function(t){return console.error(t),t})},text:function(t){return e.ajax({url:t,method:"get",dataType:"text"})},nothing:function(t){return e.promise(function(e){e(t)})},code:function(t){return O.loader.text(t)}},parser:{path:function(t,e){return t},content:function(t,e){return e},code:function(t,e){return{path:t,code:e}},css:function(t,e){return e=e.replace(/url\(.+?\)/g,function(e){var n=!1;return e=e.substring(4,e.length-1).trim(),("'"===e[0]||'"'===e[0])&&(e=e.substring(1,e.length-1),n=!0),0===e.indexOf("http:")||0===e.indexOf("data:")||0===e.indexOf("https:")?n?'url("'+e+'")':"url("+e+")":n?'url("'+O.path.getRelativePath(t,e)+'")':"url("+O.path.getRelativePath(t,e)+")"}),{path:t,code:e}},html:function(t,e){return e=e.replace(T.regs.f,"><").replace(T.regs.i,"").replace(T.regs.k,"").replace(T.regs.l,""),e=e.replace(/src=['"].+?['"]/g,function(t){if(t=t.trim(),-1===t.indexOf("<%")&&-1===t.indexOf("{{")){var e=t.substring(5,t.length-1);return 0===e.indexOf("http:")||0===e.indexOf("data:")||0===e.indexOf("https:")?'src="'+e+'"':'src="'+O.basePath+e+'"'}return t})},template:function(t,e){e=O.parser.html(t,e);for(var n={},r=e.split(T.regs.isNotep),i=e.match(T.regs.isNotes),o=0;o<i.length;o++){var s=i[o].substring(5,i[o].length-4);n[s]=r[o+1].replace(T.regs.isNotec,"")}return n}},trigger:{js:function(t,n){return e.promise(function(e){try{new Function("window","console",t.code).call(window,window,window.console)}catch(n){console.error(n)}e()})},css:function(t,n){return e.promise(function(e){for(var r=document.getElementsByTagName("style"),i=!1,o=0;o<r.length;o++)r[o].dataset&&r[o].dataset.packet===n&&(i=!0);if(i)e();else{var s=(t.path,document.createElement("style"));s.setAttribute("media","screen"),s.setAttribute("type","text/css"),s.setAttribute("data-packet",n),s.appendChild(document.createTextNode(t.code)),document.getElementsByTagName("head")[0].appendChild(s),e()}})},code:function(t,n){return e.promise(function(e){e(t.code)})},text:function(t,n){return e.promise(function(e){e(t)})},image:function(t,n){var r=t.path,i=e.promise(),o=document.createElement("img"),s=function(t){t.target.removeEventListener("load",s),t.target.removeEventListener("error",a),i.resolve(t.target)},a=function(t){t.target.removeEventListener("load",s),t.target.removeEventListener("error",a),i.reject(t)};return o.src=r,o.addEventListener("load",s,!1),o.addEventListener("error",a,!1),i},json:function(t,n){return e.promise(function(e){e(JSON.parse(t))})}},path:{getCurrentPath:function(t){if("/"===t[t.length-1])return t;var e=t.split("/");return e.pop(),e.join("/")+"/"},getParentPath:function(t,e){if(void 0===e&&(e=1),e>0){"/"===t[t.length-1]&&e++;var n=t.split("/");return n.splice(n.length-e,e),n.join("/")+"/"}return t},getRelativePath:function(t,e){t=O.path.getCurrentPath(t);var n=e.match(/^(\.{0,2}\/)+/);if(n){if(e=e.substring(n[0].length),"/"===n[0])return t+e.substring(1);var r=n[0].split("/"),i=r.length-1;return"."===r[0]?(i-=1,O.path.getParentPath(t,i)+e):O.path.getParentPath(t,i)+e}return t+e}},appender:{beforeinit:{},append:function(t){for(var e in t){O.appender.beforeinit[e]||(O.appender.beforeinit[e]=[]);for(var n in t[e])O.appender.beforeinit[e].push(t[e][n])}},excute:function(t){for(var e in t)for(var n=e,r=t[e],i=0;i<r.length;i++){var o=r[i],s=O.getProcessor(n).parser,a=O.parser[s](O.getPacketPath(o.p,n),o.c);O.local[n][o.p]={hash:o.h,content:a}}},appendSource:function(t){O.ready?O.appender.excute(t):O.appender.append(t)},appendInit:function(){O.appender.excute(O.appender.beforeinit),O.appender.beforeinit={}}}};e.source=function(t){O.appender.appendSource(t)};var E=function(){this._packets_={},this.exports={},this._depends=[],this.children=[],this.packet="",this.require=[],this.include=[],this.template=[],this.js=[],this.css=[],this.html=[],this.json=[],this.image=[],this.text=[],this.style=[],this.usestrict=!1};E.prototype.getTemplate=function(t,e){for(var n in this.template)if(this.template[n].packet===t)return"<!--("+t+"."+e+")-->"+(this.template[n].value[e]||"")},E.prototype.getJson=function(t){for(var e in this.json)if(this.json[e].packet===t)return this.json[e].value||{}},E.prototype.getImage=function(t){for(var e in this.image)if(this.image[e].packet===t)return this.image[e].value||{}},E.prototype.getHtml=function(t){for(var e in this.html)if(this.html[e].packet===t)return this.html[e].value||{}},E.prototype.getText=function(t){for(var e in this.text)if(this.text[e].packet===t)return this.text[e].value||{}},E.prototype.getChildren=function(){for(var t=[],e=0;e<this.children.length;e++)t.push(T.requiremapping[this.children[e]]);return t},E.prototype.getMapSource=function(t){var e=null,n=t.split(".");n.pop();for(var r=n.join("."),i=0;i<this.map.length;i++){var o=this.map[i];if(o.folder){if(r===o.packet){e=o;break}}else if(t===o.packet){e=o;break}}if(e)return O.get(t,e.sourceType);throw Error("[topolr] can not match the map packet of "+t)};var T=function(t){return T.run.call(this,t)};T.regs={i:/\r\n/g,k:/\r/g,l:/\n/g,f:/>[\s]+</g,isdot:/\./g,issuffix:/\[.*\]/g,isNote:/\/\*[\w\W]*?\*\//,isNoteall:/\/\*[\w\W]*?\*\//g,isInfo:/@([\s\S]*?);/g,isPacketTag:/["\']@[A-Za-z0-9_\[\]-]+\.[A-Za-z0-9_-]*["\']/g,isCurrentTag:/["\']@\.[A-Za-z0-9_-]+["\']/g,isMapTag:/["\']@[A-Za-z0-9_\[\]-]+\.[A-Za-z\[\]0-9_-]*["\']/g,isPacket:/["\']@[A-Za-z0-9_\[\]-]+["\']/g,isOther:/["\']\\@[A-Za-z0-9_-]+["\']/g,isNotep:/\<\!\-\-\[[0-9a-zA-Z-_]*?\]\-\-\>/,isNotes:/\<\!\-\-\[[0-9a-zA-Z-_]*?\]\-\-\>/g,isNotec:/\<\!\-\-[\s\S]*?\-\-\>/g,isNotet:/\<\!\-\-\[@[\s\S]*?;\]\-\-\>/,isNotets:/\<\!\-\-\[@[\s\S]*?;\]\-\-\>/g,isCssPath:/url\(.+?\)/g,issuffixp:/\[|\]/},T.requiremapping={},T.packetDone=[],T.mapping={packet:"js",html:"html",template:"html",js:"js",css:"css",text:"txt",json:"json",image:"png",include:"js",require:"js",style:"css"},T.packetsmapping={},T.deleteR=function(t,e){if(x.option.debug){e||(e=3);for(var n=0,r="",i=0,o=t.length;o>i;i++)"\n"===t[i]||"\r"===t[i]?(n>e&&(r+=t[i]),n++):r+=t[i];return r}return t},T.run=function(t){this.info=[];var n=this,r=e.promise();return this.load(t).done(function(){var t=T.dependsSort.call(n,n.info);if(t.length!==n.info.length)throw Error("[topolr] packets depend error,maybe cyclic dependency or some file has no packet info.");n.info=t;for(var i=0;i<n.info.length;i++){var o=n.info[i].info;if(!T.requiremapping[o.packet]){T.requiremapping[o.packet]=o;var s=T.deleteR(n.info[i].code)+"!$.is.isEmptyObject(exports)?(module.exports=exports):'';";"true"===o.usestrict&&(o.usestrict=!0),x.option.debug&&(s=(o.usestrict?'"use strict";':"")+s+"//# sourceURL="+o.path.split("?")[0]);try{o.sitePath=x.option.sitePath,o.basePath=x.option.basePath,o.currentPath=O.path.getCurrentPath(o.path),new Function("window","$","Module","Option","module","exports","require","sitePath","App","console",s).call(o,window,e,function(t){t.packet=o.packet,e.Module(t)},function(t){t.name=o.packet?o.packet+"."+t.name:t.name,e.Option(t,o.packet)},o,{},function(t){var e=T.requiremapping[t];if(e)return e.exports;throw Error("[topolr] method require() called error,packet of "+t+" is not required in packet of "+o.packet)},x.option.sitePath,window.App,window.console),T.packetsmapping[o.packet]=o}catch(a){console.error("[topolr] packet import error name of "+o.packet+" path of "+o.path+" Message:"+a.stack)}}}r.resolve(),n.clean()}),r},T.dependsSort=function(t){for(var e=[],n=[],r=0;r<t.length;r++){var i=t[r];i.dependTimes=i.info._depends.length;for(var o=0;o<i.info._depends.length;o++){var s=i.info._depends[o];-1!==T.packetDone.indexOf(s)&&(i.dependTimes=i.dependTimes-1)}}for(var r=0;r<t.length;r++){var i=t[r];0===i.dependTimes||0===i.info._depends.length?(T.packetDone.push(i.info.packet),e.push(i)):(i.dependTimes=i.info._depends.length,n.push(i))}for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<n.length;o++){var a=n[o];if(-1!==a.info._depends.indexOf(i.info.packet)&&(a.dependTimes=a.dependTimes-1,a.dependTimes<=0)){T.packetDone.push(a.info.packet),e.push(a),n.splice(o,1);break}}for(var r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.info._depends.length;o++){var a=i.info._depends[o];if(-1!==T.packetDone.indexOf(a)&&(i.dependTimes=i.dependTimes-1,i.dependTimes<=0)){T.packetDone.push(i.info.packet),e.push(i),n.splice(r,1);break}}return e},T.getPacketInfo=function(t){var e=t.match(T.regs.isNote),n=(x.option.basePath,new E);if(e&&e.length>0)for(var r=e[0],i=r.match(T.regs.isInfo),o=0;o<i.length;o++){var e=i[o],s=e.split(" ");if(s.length>=2){var a=s[0].substring(1,s[0].length),l=";"===s[1][s[1].length-1]?s[1].substring(0,s[1].length-1):s[1],u=(l.split(T.regs.issuffixp)[1]||"",l.split(":")[1]?l.split(":")[1]:l.split(".").pop());"image"!==a&&"text"!==a&&"map"!==a&&(l=l.replace(T.regs.issuffix,"")),l=l.split(":")[0];var c=O.getPacketPath(l,T.mapping[a]),p={packet:l,path:c,value:null};if("packet"===a&&(n.packet=l,n.path=c),"require"===a&&(n._depends.push(l),n.children.push(l)),"include"===a&&n.children.push(l),"js"===a&&-1!==l.indexOf("http")&&(p.path=l),"map"===a){var e=l.split(/\(|\)/);p="*"===e[2][e[2].length-1]?{sourceType:e[1],packet:e[2].substring(0,e[2].length-2),folder:!0}:{sourceType:e[1],packet:e[2],folder:!1},l=e[2]}n[a]||(n[a]=[]),-1===n[a].indexOf(p)&&n[a].push&&n[a].push(p),n._packets_[u]=l}}else n.packet="nopacket";return n},T.replacePacketNames=function(t,e){return e.replace(T.regs.isPacketTag,function(e){var n=e.split("."),r=0,i=n[1].substring(0,n[1].length-1),r=n[0].substring(2);if(t._packets_[r]){if(-1===t._packets_[r].indexOf("*"))return e[0]+t._packets_[r]+"."+i+e[e.length-1];var n=t._packets_[r].split(".");return n.pop(),e[0]+n.join(".")+"."+i+e[e.length-1]}throw Error("[topolr] packet can not find with tag of "+e+",packet is "+t.packet)}).replace(T.regs.isCurrentTag,function(e){return e[0]+t.packet+"."+e.split(".")[1]}).replace(T.regs.isPacket,function(e){var n=e.substring(2,e.length-1);if(t._packets_[n])return e[0]+t._packets_[n]+e[e.length-1];throw Error("[topolr] packet can not find with tag of "+e+",packet is "+t.packet)}).replace(T.regs.isMapTag,function(e){var n=e.substring(1,e.length-1).split("."),r=n.shift().substring(1),i=t._packets_[r];if(i){var o=i.split(".");o.pop();var s=e[0]+o.join(".")+"."+n.pop()+e[e.length-1];return s}throw Error("[topolr] packet can not find with tag of "+e+",packet is "+t.packet)}).replace(T.regs.isOther,function(t){return t.substring(1)})},T.prototype.load=function(t){var n=this,r=O.getPacketPath(t,"js"),i=e.promise();return O.get(t,"packet").then(function(t){var o=T.getPacketInfo.call(n,t);"nopacket"===o.packet&&console.error("[topolr] file has no packet info,path of "+r),n.info.push({info:o,code:T.replacePacketNames.call(n,o,t)});var s=["json","html","text","js","css","template","image","style"],a=e.queue();for(var l in s)for(var u=o[s[l]],c=0;c<u.length;c++)a.add(function(t,e){O.get(e.info.packet,e.type).done(function(t){e.info.value=t,a.next()})},function(t,e){console.error(e)},{info:u[c],type:s[l]});for(var c=0;c<o.require.length;c++)a.add(function(t,e){n.load(e.packet).done(function(){a.next()})},function(t,e){console.log(t)},{path:o.require[c].path,packet:o.require[c].packet});a.complete(function(){i.resolve()}).run()}).fail(function(t){console.error(t)}),i},T.prototype.clean=function(){for(var t in this)this[t]=null};var S=function(){};S.isSuper=/superClass\(.*?\)/g,S.superInvoke=function(t,e,n,r){if(t.__superinvoke__&&!t.__superinvoke__[e+n])return t.__superinvoke__[e+n]=1,S.superInvoke(t,t.__superinvoke__.current,n,r);if(t.__superinvoke__||(t.__superinvoke__={}),t.__superinvoke__[e+n]&&1!==t.__superinvoke__[e+n]||(t.__superinvoke__[e+n]={}),t.__superinvoke__[e+n].calling)return t.__superinvoke__[e+n].returns.shift();var i=Object.getPrototypeOf(t),o=null;if(e)for(;i;){if(i.__info__.name===e){o=i;break}i=Object.getPrototypeOf(i)}else o=t;if(o){t.__superinvoke__[e+n].returns=[],t.__superinvoke__[e+n].propName=n,t.__superinvoke__[e+n].current="";for(var s=[],a=[];o;){var l=o[n].toString().match(S.isSuper);if(!(l&&l.length>0)){s.push(o[n]),a.push(o.__info__.name);break}for(var u=0;u<l.length;u++){var c=l[u].substring(12,l[u].length-2),p=c.split(",").shift();p=p.substring(1,p.length-1),p===n&&(s.push(o[n]),a.push(o.__info__.name))}o=Object.getPrototypeOf(o)}s.length>1&&(s.shift(),s.reverse(),a.shift(),a.reverse());var h=null;t.__superinvoke__[e+n].calling=!0;for(var u=0;u<s.length;u++){t.__superinvoke__.current=a[u];var d=s[u].apply(t,r);t.__superinvoke__[e+n].returns.push(d),h=d}t.__superinvoke__[e+n].calling=!1,t.__superinvoke__[e+n].returns=[],t.__superinvoke__[e+n]=null;var f=!0;for(var u in t.__superinvoke__)"current"!==u&&null!==t.__superinvoke__[u]&&1!==t.__superinvoke__[u]&&(f=!1);return f&&(t.__superinvoke__=null),h}return null},Object.defineProperty(S.prototype,"__info__",{enumerable:!1,configurable:!1,writable:!1,value:{name:"adapt","short":"adapt","interface":null,"super":null,packet:null,types:["adapt"]}}),S.prototype.option={},S.prototype.privator=function(){var t=Array.prototype.slice.call(arguments),n=t.shift();return e.is.isFunction(this["_"+n])?this["_"+n].apply(this,t):this["_"+n]},S.prototype.staticor=function(){var t=Array.prototype.slice.call(arguments),n=t.shift();return e.is.isFunction(this["__"+n])?this["__"+n].apply(this,t):this["__"+n]},S.prototype.type=function(){return this.__info__.name},S.prototype.shortName=function(){return this.__info__["short"]},S.prototype.packet=function(){return this.__info__.packet},S.prototype.typeOf=function(t){for(var e=this,n=!1;e.__info__;){var r=e.__info__;if(-1!==r.types.indexOf(t)){n=!0;break}e=Object.getPrototypeOf(e)}return n},S.prototype.extendsOf=function(t){for(var e=this,n=!1;e.__info__;){if(e.__info__.name===t){n=!0;break}e=Object.getPrototypeOf(e)}return n},S.prototype.clean=function(){var t=["type","shortName","typeOf","extendsOf","packet"];for(var e in this)-1===t.indexOf(e)&&(this[e]=null)},S.prototype.superClass=function(t){t||(t="init");var e="",n=Object.keys(this);-1===n.indexOf(t)&&(e=Object.getPrototypeOf(this).__info__.name);var r=Array.prototype.slice.call(arguments);return r.shift(),S.superInvoke(this,e,t,r)},S.prototype.instanceId=function(){return this._instanceId||(this._instanceId=l.randomid(10)),this._instanceId},S.prototype.getUUID=function(){return this._uuid},S.prototype.getShortUUID=function(){return this._uuid.substring(0,8)};var j=function(){this._mapping={adapt:S}};j.prototype.def=function(t){t.extend?e.is.isString(t.extend)&&(t.extend=[t.extend]):t.extend=["adapt"];var n=new this._mapping[t.extend[0]],r=Object.getPrototypeOf(n),i=[t.option],o=[t.services||{}];i.push(r.option?e.json.clone(r.option):{}),o.push(r.services?e.json.clone(r.services):{});var s=[],a=[t.packet?t.packet+"."+t.name:t.name];if(t.extend.length>1){a.push(t.extend.shift());for(var u=0;u<t.extend.length;u++){var c=t.extend[u],p=this._mapping[c];if(p){s.push(c);for(var h=Object.keys(p.prototype),d=0;d<h.length;d++){var f=h[d];"option"!==f&&"init"!==f&&"services"!==f&&(n[f]=p.prototype[f])}i.push(e.json.clone(p.prototype.option)),o.push(e.extend({},p.prototype.services))}}}i.reverse(),i.unshift({}),i.unshift(!0),n.option=e.extend.apply({},i),o.reverse(),o.unshift({}),o.unshift(!0),n.services=e.extend.apply({},o);var g=["name","extend","shortName","packet","option","services"];for(var u in t)-1===g.indexOf(u)&&(n[u]=t[u]);n.init||(n.init=function(){});var v=a.concat(t.extend);if(this._mapping[t.extend[0]].prototype.__info__)for(var u in this._mapping[t.extend[0]].prototype.__info__.types){var c=this._mapping[t.extend[0]].prototype.__info__.types[u];-1===v.indexOf(c)&&v.push(c)}l.setReadOnlyProps(n,{__info__:l.setReadOnlyProps({},{name:t.packet?t.packet+"."+t.name:t.name,"short":t.name||"",packet:t.packet||"","interface":s,"super":a.join(""),types:v})});var m=function(){};return m.prototype=n,this._mapping[n.__info__.name]=m,this},j.prototype.get=function(t){return this._mapping[t]},j.prototype.create=function(t,e){var n=this.instance(t,e);if(n)for(var r=n.__info__.types.length-1;r>=0;r--){var i=this._mapping[n.__info__.types[r]];i&&i.prototype.init&&i.prototype.init.call(n,n.option)}return n},j.prototype.instance=function(t,n){var r=null,i=t,o=this._mapping[i];return o&&(r=new o,l.setReadOnlyProps(r,{_uuid:l.uuid()}),r.option=e.extend({},e.json.clone(o.prototype.option),n)),r},j.prototype.invoke=function(t,e,n){var i=null;if(r.isString(t)){var o=this._mapping[t];o&&(i=new o)}else r.isObject(t)&&(i=t);if(i&&i[e]&&r.isFunction(i[e])&&r.isObject(n)){var s=Array.prototype.slice.call(arguments),a=Object.keys(n),l=i;s.splice(0,3);for(var u=0;u<a.length;u++)l[a[u]]=n[a[u]];try{for(var c=l[e].apply(l,s),p=Object.keys(l),u=0;u<p.length;u++)n[p[u]]=l[p[u]];return c}catch(h){return console.error(h.stack),null}}return null},j.prototype.has=function(t){return void 0!==this._mapping[t]},e.adapt=function(){return new j};var I=function(t,e){this.tag=t||"",this.props=e||{},this.hasProp=!1,this.children=[],this.parent=null};I.filter=function(t){return t.trim().replace(P.regs.isNote,"").replace(P.regs.isDoctype,"").replace(P.regs.isXmlTag,"")},I.repairTag=function(t){for(var e=["br","hr","img","input","param","link","meta","area","base","basefont","param","col","frame","embed","keygen","source"],n=0;n<e.length;n++){var r=new RegExp("<"+e[n]+" .*?>","g");t=t.replace(r,function(t){return t.substring(0,t.length-1)+"/>"})}return t},I.parse=function(t){if(t&&""!==t){t=I.filter(t),t=I.repairTag(t);for(var e=[],n=[],r=null,i="",o="",s="",a="",l="",u=!1,c=!1,p=!1,h=!1,d=!1,f=0,g=t.length;g>f;f++){var v=t[f];if("\r"!==v&&"\n"!==v){if("<"===v){d=!0,""!==l.trim()&&(r=new A(l.trim(),e[e.length-1]||null),e[e.length-1]?e[e.length-1].children.push(r):n.push(r),l=""),t[f+1]&&"/"===t[f+1]?h=!0:(r=new I,e.push(r),e.length-2>=0&&(e[e.length-2].children.push(r),r.parent=e[e.length-2]),u=!0);continue}if(" "===v){if(d&&(u&&(u=!1,r.tag=i.trim(),i=""),!c&&!p)){c=!0;continue}}else if("="===v)d&&(c=!1);else if("'"===v||'"'===v){if(!p&&d){p=v;continue}p===v&&(p=!1,r.hasProp=!0,r.props[s.trim()]=a.trim(),s="",a="")}else{if(">"===v){d=!1,c=!1,p=!1,u=!1,h&&(h=!1,o="",1===e.length&&n.push(e[0]),e.pop()),r.hasProp||(""===r.tag&&(r.tag=i.trim()),i="");continue}if("/"===v){t[f+1]&&">"===t[f+1]?(d=!1,p=!1,c=!1,h=!1,u=!1,o="",1===e.length&&n.push(e[0]),r.hasProp||(""===r.tag&&(r.tag=i.trim()),i=""),e.pop()):d?p&&(a+=v):l+=v;continue}}u&&(i+=v),c&&(s+=v),p&&(a+=v),h&&(o+=v),!d&&(l+=v)}}return l&&n.push(new A(l,null)),n}return[]},I.prototype.hasCode=function(){return!1},I.prototype.code=function(t){var e="",n="";this.parent?(e="__$$node$$"+t,n='{tag:"'+this.tag+'",props:'+JSON.stringify(this.props)+",children:[]};",n+="__$$$current="+e+";"):(e="__$$node$$"+t,n="var "+e+'={tag:"'+this.tag+'",props:'+JSON.stringify(this.props)+",children:[]};",n+="__$$$current="+e+";");for(var r=0,i=this.children.length;i>r;r++)if(this.children[r].hasCode())n+=this.children[r].content;else{var o="__$$node$$"+(t+1);t+=1,n+="var "+o+"="+this.children[r].code(t),n+=e+".children.push("+o+");",n+="__$$$current="+e+";"}return n};var A=function(t,e){this.content=t,this.parent=e};A.prototype.code=function(t){return this.hasCode()?this.content:'{content:"'+this.content+'"};'},A.prototype.hasCode=function(){return/\(\[-code-\]\)/.test(this.content)};var P=function(t,n){var r=e.extend({macro:{},parameters:null,autodom:!1,renderId:null},n),i=P.getParseInfo.call(this,t,r.parameters,r.autodom);this._parameters=r.parameters,this._renderId=r.renderId,this._autodom=r.autodom,this._macrofn=r.macro||{},this._scope=i.info.info,this._code=i.tcode,this._fn=i.tfn,r.autodom&&(this._autocode=i.acode,this._autocodefn=i.afn),this._source=i.source,this._session=null,this._caching={},this._isupdate=!1,this._propshookinfo=i.propshookinfo,e.extend(this._macrofn,P.globalMacro)};P.regs={k:/\r/g,l:/\n/g,a:/&lt;/g,b:/&gt;/g,d:/<%|%>/g,e:/^=.*;$/,i:/\r\n/g,f:/>[\s]+</g,g:/<%[\s\S]*%>/,h:/\<\!\-\-[\s\S]*?\-\-\>/g,ch:/@cache\(.*?\)/g,df:/data-find=['"][\s\S]+?['"]/g,dg:/data-group=['"][\s\S]+?['"]/g,db:/data-bind=['"][\s\S]+?['"]/g,isDoctype:/\<\!DOCTYPE[\s\S]*?\>/g,isNote:/\<\!\-\-[\s\S]*?\-\-\>/g,isXmlTag:/\<\?[\s\S]*?\?\>/g},P.compileCache=[],P.globalMacro={include:function(t,e,n){return this.renderInContext(t.template)},self:function(t,e,n){return P.exceute.call(this,this._fn,[t.data])}},P.beatySyntax={syntaxs:{defaults:function(t){return"<%="+t.substring(2,t.length-2)+";%>"},log:function(t){return"<%console.log("+t.join(" ")+");%>"},map:function(t){var e=t.shift();t.shift();var n=t.shift()||"$value",r=t.shift()||"$key",i="_"+l.randomid(8);return"<%for(var "+i+" in "+e+"){ var "+n+"="+e+"["+i+"];var "+r+"="+i+";%>"},"/map":function(){return"<%}%>"},list:function(t){var e=t.shift();t.shift();var n=t.shift()||"$item",r=t.shift()||"$index",i="_"+l.randomid(8),o="_"+l.randomid(6);return"<%if("+e+"&&"+e+".length>=0)for(var "+i+"=0,"+r+"=0,"+o+"="+e+".length;"+i+"<"+o+";"+i+"++){ var "+n+"="+e+"["+i+"];"+r+"="+i+";%>"},"/list":function(t){return"<%}%>"},"if":function(t){return"<%if("+t.join(" ")+"){%>"},elseif:function(t){return"<%}else if("+t.join(" ")+"){%>"},"else":function(){return"<%}else{%>"},"/if":function(){return"<%}%>"},"break":function(){return"<%break;%>"},set:function(t){return"<%var "+t.join(" ")+"%>"}},parse:function(t){return t.replace(/\{\{[\s\S]+?\}\}/g,function(t){var e=t.substring(2,t.length-2),n=e.split(" "),r=n.shift();try{return P.beatySyntax.syntaxs[r]?P.beatySyntax.syntaxs[r](n):P.beatySyntax.syntaxs.defaults(t)}catch(i){console.log(i)}})}},P.propshook=function(t){var e={},n=t.replace(P.regs.df,function(t){return"data-find='<%=this._prophook(\""+t.substring(11,t.length-1)+"\");%>'"}).replace(P.regs.dg,function(t){return"data-group='<%=this._prophook(\"g:"+t.substring(11,t.length-1)+"\");%>'"}).replace(P.regs.db,function(t){for(var n=t.substring(11,t.length-1),r=n.split(" "),i=0;i<r.length;i++){var o=r[i].split(":");e[o[0]]=o[1]}return"data-bind='<%=this._prophook(\""+n+"\");%>'"}).replace(P.regs.ch,function(t){var e=t.substring(7,t.length-1);return"data-cache='<%=this._cache("+e+");%>'"});return{template:n,propshookinfo:e}},P.precompile=function(t,e){if(t=t.replace(P.regs.a,"<").replace(P.regs.b,">").replace(P.regs.h,"").replace(P.regs.f,"><").replace(P.regs.i,"").replace(P.regs.k,"").replace(P.regs.l,""),-1!==t.indexOf("<@")){for(var n,r=-1,i="",o="start",s="",a="",l="",u=!0,c="",p={},h=0,d=0,f=0,g=0,v=[];r<t.length;)r++,i=t[r],"start"!==o||"<"!==i||"@"!==t[r+1]?"tagstart"!==o||"@"!==i?"start"!==o||"<"!==i||"/"!==t[r+1]||"@"!==t[r+2]?"endtag"!==o||">"!==i?"tagname"!==o||" "!==i?"tagname"!==o||"/"!==i&&">"!==i?"propname"!==o||"="!==i?"propvalue"!==o||"'"!==i&&'"'!==i?"propvalueing"!==o||i!==n?("endtag"===o&&(c+=i),"tagname"===o&&(s+=i),"propname"===o&&(a+=i),"propvalueing"===o&&(l+=i)):(o="tagname",p[a]=l):(o="propvalueing",n=i,l=""):o="propvalue":(">"===i?(d=r+1,o="start",u=!0):"/"===i&&(d=r+2,o="start",u=!1),""!==s&&v.push({type:"tag",tagname:s,props:p,body:u,start:h,end:d})):(o="propname",a=""):(o="start",g=r+1,v.push({type:"endtag",tagname:c,start:f,end:g})):(f=r,o="endtag",c="",r+=2):(o="tagname",s="",p={}):(o="tagstart",h=r);var m=0,y=0,_=0,b=!1,i=null,w=[],k="",x="",N=0,O=[];for(var r in v)"tag"===v[r].type&&v[r].body===!1&&b===!1&&(v[r].bodystr="",v[r].from=v[r].start,v[r].to=v[r].end,w.push(v[r])),"tag"===v[r].type&&v[r].body===!0&&(b=!0,null===i&&(i=v[r],i.from=v[r].start),0===m&&(y=v[r].start,_=v[r].end),m++),"endtag"===v[r].type&&(m--,0===m&&(i.to=v[r].end,i.bodystr=t.substring(_,v[r].start),w.push(i),i=null,b=!1));for(var r in w){var E=w[r].props,T="";for(var S in E){var j=E[S];if(P.regs.g.test(j)){for(var I=j.split(P.regs.d),A="",C=1;C<=I.length;C++)C%2===0?""!==I[C-1]&&(A+=I[C-1]+"+"):A+=""!==I[C-1]?"'"+I[C-1]+"'+":I[C-1];var q=A.length>0?A.substring(0,A.length-1):"''";T+=S+":"+q.substring(1,q.length-1)+","}else T+=S+":'"+E[S].substring(1,E[S].length-1)+"',"}w[r].parameter="{"+(T.length>0?T.substring(0,T.length-1):T)+"}",O.push({name:w[r].tagname,body:w[r].bodystr,parameter:w[r].parameter});var M=t.substring(N,w[r].from);k+=M,e&&(x+=M,x+="<%var tp=this._macro("+r+(""===w[r].parameter?"":","+w[r].parameter)+");if(tp){var c=__$$$node$$$.parse(tp);for(var ____$$$$i=0;____$$$$i<c.length;____$$$$i++){{{node}}.children.push(c[____$$$$i])}}else{{{node}}.children.push({content:''})}%>"),
k+="<%=this._macro("+r+(""===w[r].parameter?"":","+w[r].parameter)+");%>",N=w[r].to}return k+=t.substring(N,t.length),e&&(x+=t.substring(N,t.length)),{template:k,virtemplate:x,info:O}}return{template:t,virtemplate:t,info:[]}},P.getParseInfo=function(t,e,n){for(var i=null,o=t,s=0;s<P.compileCache.length;s++){var a=P.compileCache[s];a.template===t&&(i=a)}if(i){for(var l=null,u=0;u<i.fns.length;u++){var c=i.fns[u];if(r.isSameArray(c.parameters,e)){l=c;break}}if(l)n&&!i.acode&&(i.acode=P.autocode(i.info.virtemplate,i.path)),n&&!l.afn&&(l.afn=P.autocompile(h,e));else{var p=null,h="";n&&(h=P.autocode(i.info.virtemplate,i.path),p=P.autocompile(h,e)),i.acode=h,i.fns.push({parameters:e,tfn:P.compile(i.tcode,e),afn:p})}return{acode:i.acode,afn:l.afn,tcode:i.tcode,tfn:l.tfn,info:i.info,path:i.path,source:i.source,propshookinfo:i.propshookinfo}}var d="",f="",g="",v="",m=null;if(x.option.debug){var y=t.match(P.regs.h);y?(d=y[0].substring(5,y[0].length-4),f=x.option.basePath+d.replace(/\./g,"/")+".js"):(d="tempcompile/template-"+t.length,f=x.option.basePath+d+".js")}var _=P.propshook(t),b=_.propshookinfo;t=_.template,t=P.beatySyntax.parse(t);var w=P.precompile(t,n);g=P.code(w.template,f),n&&(v=P.autocode(w.virtemplate,f),m=P.autocompile(v,e));var l={parameters:e,tfn:P.compile(g,e),afn:m};return i={template:o,info:w,tcode:g,acode:v,path:f,source:t,fns:[l],propshookinfo:b},P.compileCache.push(i),{acode:i.acode,afn:l.afn,tcode:i.tcode,tfn:l.tfn,info:i.info,path:i.path,source:i.source,propshookinfo:b}},P.diff=function(t,e){var n={add:[],replace:[],remove:[],edit:[],removeAll:[],bremove:[]},r=[];return P.diffNode(t,e,r,n),e.length=0,n},P.diffNode=function(t,e,n,r){if(t&&e){var i=t.length;if(0===t.length)0!==e.length&&r.removeAll.push({path:n.join(",")});else{if(t.length<e.length)if(t[0].props&&t[0].props.unique){for(var o=P.checkRemove(t,e),s=[],a=0,l=o.length;l>a;a++)s.push(e[o[a]]),r.bremove.push({path:n.join(",")+","+o[a]});for(var a=0,l=s.length;l>a;a++)e.splice(e.indexOf(s[a]),1)}else i=e.length;for(var a=0;i>a;a++){if(n.push(a),t[a])if(e[a]){if(!t[a].props||void 0===t[a].props["data-view"]){var u=P.checkNode(t[a],e[a]);u===!0?P.diffNode(t[a].children,e[a].children,n,r):"replace"===u?r.replace.push({path:n.join(","),node:t[a]}):(r.edit.push({path:n.join(","),props:u}),P.diffNode(t[a].children,e[a].children,n,r))}}else r.add.push({path:n.join(","),node:t[a]});else r.remove.push({path:n.join(","),node:e[a]});n.pop()}}}},P.checkRemove=function(t,e){for(var n=[],r=[],i=0,o=t.length;o>i;i++)n.push(t[i].props.unique);for(var i=0,o=e.length;o>i;i++)-1===n.indexOf(e[i].props.unique)&&r.push(i);return r},P.checkNode=function(t,e){var n=!0;if(void 0!==t.content)n=t.content===e.content?!0:"replace";else{if(t.tag===e.tag)return P.checkProps(t.props,e.props);n="replace"}return n},P.checkProps=function(t,e){var n=Object.keys(t),r=Object.keys(e),i={"final":t},o=n.length,s=!1;n.length<r.length&&(o=r.length);for(var a=0;o>a;a++){var l=n[a];if(!l){s=!0;break}if(void 0===e[l]){s=!0;break}if(t[l]!==e[l]){s=!0;break}}return s?i:!0},P.element=function(t,e){if("svg"===t.tag&&(e?"":e=!0),void 0!==t.content)return e?window.document.createElementNS("http://www.w3.org/2000/svg","text"):window.document.createTextNode(t.content);var n=null;n=e?window.document.createElementNS("http://www.w3.org/2000/svg",t.tag):window.document.createElement(t.tag);for(var r in t.props)if(e){var i=r.split(":");i.length>1?n.setAttributeNS("http://www.w3.org/1999/"+i[0],i[1],t.props[r]):n.setAttributeNS(null,i[0],t.props[r])}else n.setAttribute(r,t.props[r]);for(var r=0;r<t.children.length;r++)n.appendChild(P.element(t.children[r],e));return n},P.effect=function(t,e){x.option.debug&&console.log("Add:"+e.add.length+" Replace:"+e.replace.length+" Remove:"+e.remove.length+" Edit:"+e.edit.length+" removeAll:"+e.removeAll.length+" Bremove:"+e.bremove.length);for(var n=[],r=0,i=e.bremove.length;i>r;r++){for(var o=t.get(0),s=e.bremove[r].path.split(","),a=0,l=s.length;l>a;a++)o=o.childNodes[s[a]/1];n.push(o)}for(var r=0,i=n.length;i>r;r++)n[r].parentNode.removeChild(n[r]);for(var u=[],c={},r=0,i=e.replace.length;i>r;r++){for(var o=t.get(0),s=e.replace[r].path.split(","),p=!1,a=0,l=s.length;l>a;a++){var h=o.childNodes[s[a]/1];h?(o=h,p=!0):(p=!1,o.appendChild(P.element(e.replace[r].node)))}p&&o.parentNode.replaceChild(P.element(e.replace[r].node),o)}for(var r=0,i=e.add.length;i>r;r++){var o=t.get(0),s=e.add[r].path.split(",");s.pop();for(var d=s.join(""),a=0,l=s.length;l>a;a++)o=o.childNodes[s[a]/1];c[d]?c[d].push({p:o,n:e.add[r].node}):c[d]=[{p:o,n:e.add[r].node}]}for(var r=0,i=e.remove.length;i>r;r++){for(var o=t.get(0),s=e.remove[r].path.split(","),f=s.pop(),a=0,l=s.length;l>a;a++)o=o.childNodes[s[a]/1];u.push(o.childNodes[f])}for(var r=0,i=e.edit.length;i>r;r++){var o=t.get(0),s=e.edit[r].path.split(",");for(var a in s)o=o.childNodes[s[a]/1];var g=e.edit[r].props,v=[];if(o.attributes.getNamedItem)for(var m=0;m<o.attributes.length;m++)v.push(o.attributes[m].nodeName);else for(var m in o.attributes)v.push(m);for(var a in g["final"]){o.getAttribute(a)!==g["final"][a]&&(o.setAttribute(a,g["final"][a]),o[a]=g["final"][a]);var y=v.indexOf(a);-1!==y&&v.splice(y,1)}for(var a=0;a<v.length;a++)o.removeAttribute(v[a])}for(var r=0,i=u.length;i>r;r++)u[r].parentNode.removeChild(u[r]);for(var r=0,i=e.removeAll.length;i>r;r++){var o=t.get(0);if(e.removeAll[r].path)for(var s=e.removeAll[r].path.split(","),a=0,l=s.length;l>a;a++)o&&(o=o.childNodes[s[a]/1]);o&&(o.innerHTML="")}for(var r in c)if(c[r].length>0){for(var _=window.document.createDocumentFragment(),o=0,i=c[r].length;i>o;o++)_.appendChild(P.element(c[r][o].n));c[r][0].p.appendChild(_)}else c[r].p.appendChild(P.element(c[r].n))},P.code=function(t,e){var n="",r="__$$out$$+";x.option.debug&&(n="/* template source:\r\n"+t+"*/\r\n\r\n",n+="/* compile code:*/\r\n",r="\r\n__$$out$$+"),n+="var __$$out$$='';";for(var i=t.split(P.regs.d),o=0;o<i.length;o++){var s=i[o];n+=o%2!==0?P.regs.e.test(s)?r+"=(("+s.substring(1,s.length-1)+")!==undefined?("+s.substring(1,s.length-1)+"):'');":s:r+"="+JSON.stringify(s)+";"}return n+="return __$$out$$;",x.option.debug&&(n+="//# sourceURL="+e),n},P.autocode=function(t,e){for(var n="",r="",i=[],o=[],s=t.replace(P.regs.a,"<%").replace(P.regs.b,"%>").split(P.regs.d),a=0;a<s.length;a++){var l=s[a];a%2!==0?P.regs.e.test(l)?(n+=r+"[[-code-]]",i.push(l)):(n+="(([-code-]))",o.push(l)):n+=r+l}for(var u=I.parse(n),c='"use strict";\r\nvar __$$r$$=[],__$$$current=null;\r\n',p=0,h=u.length;h>p;p++){var d=p+"_0",f=u[p].code(d);c+=f+"\r\n",-1!==f.indexOf("__$$node$$"+d)&&-1===f.indexOf("__$$r$$.push(__$$node$$"+d+")")&&(c+="__$$r$$.push(__$$node$$"+d+");\r\n")}return c=c.replace(/\(\(\[-code-\]\)\)/g,function(t,e,n){var r=o.shift();return r}).replace(/\[\[-code-\]\]/g,function(t,e,n){var r=i.shift();return r&&"="===r[0]?'"+(('+r.substring(1,r.length-1)+")!==undefined?("+r.substring(1,r.length-1)+"):'')+\"":r}).replace(/\{\{node\}\}/g,function(t,e,n){return"__$$$current"}),c+="return __$$r$$;",x.option.debug&&(c+="//# sourceURL="+e.substring(0,e.length-3)+"-autodom.js"),c},P.compile=function(t,e){try{var n=[];if(e)for(var r=0;r<e.length;r++)n.push(e[r]);else n=["data"];var i=function(t,e){function n(){return t.apply(this,e)}return n.prototype=t.prototype,new n};return n.push(t),n.unshift("window"),n.unshift("$"),n.unshift("__$$$node$$$"),i(Function,n)}catch(o){return console.error("[template compile error] \r\n"+o.stack+"\r\n"+t),function(){return""}}},P.autocompile=function(t,e){return e||(e=["data"]),P.compile(t,e)},P.exceute=function(t,e){var n="";this._session=e;try{this._session.unshift(window),this._session.unshift(window.topolr),this._session.unshift(I),n=t.apply(this,this._session)}catch(r){console.error("[topolr] template render called error, Message:"+r.stack)}return n},P.prototype._cache=function(t){var e="";return r.isObject(t)||r.isArray(t)?t.__cacheid__?e=t.__cacheid__:(e=l.randomid(8),Object.defineProperty(t,"__cacheid__",{enumerable:!1,configurable:!1,writable:!1,value:e})):e=l.randomid(8),this._caching[e]=t,e},P.prototype._prophook=function(t){return this._renderId+"-"+t},P.prototype._macro=function(t,e){var n=this._scope[t],r=this;return this._macrofn[n.name]?this._macrofn[n.name].call(this,e,function(t){if(""!==n.body){var e=[],i=[],o=[],s=[];for(var a in t)-1===r._parameters.indexOf(a)&&(e.push(a),i.push(t[a]));o=r._parameters.concat(e);for(var l=[],a=0;a<r._session.length;a++)a>2&&l.push(r._session[a]);s=l.concat(i);var u=new P(n.body,r._macrofn,o);return u._caching=r._caching,u.render.apply(u,s)}return""},""!==n.body):(console.error("[topolr] macro can not found ["+n.name+"] template is "+this._source),"")},P.prototype.session=function(){return 0===arguments.length?this._session:(this._session=arguments[0],this)},P.prototype.render=function(){return P.exceute.call(this,this._fn,Array.prototype.slice.call(arguments))},P.prototype.autoDom=function(){return this._isupdate?this._caching={}:this._isupdate=!0,P.exceute.call(this,this._autocodefn,Array.prototype.slice.call(arguments))},P.prototype.renderTo=function(){this._caching={};var t=Array.prototype.slice.call(arguments),e="",n=t.shift();e=P.exceute.call(this,this._fn,t),this.flush(n.html(e))},P.prototype.renderAppendTo=function(){this._caching={};var t=Array.prototype.slice.call(arguments),n="",r=t.shift();n=P.exceute.call(this,this._fn,t),this.flush(e(n).appendTo(r))},P.prototype.flush=function(t){t.data("--cache--",this._caching)},P.prototype.code=function(){return this._code},P.prototype.macro=function(t,e){return 1===arguments.length?this._macrofn=t||{}:2===arguments.length&&(this._macrofn[t]=e),this},P.prototype.isAutodom=function(){return this._autodom},P.prototype.renderInContext=function(){for(var t=[],e=0;e<this._session.length;e++)t.push(this._session[e]);t.splice(0,3);for(var n=Array.prototype.slice.call(arguments),r=n.shift(),e=0;e<n.length;e++)t[e]=n[e];var i=new P(r,this._macrofn,this._parameters),o=i.render.apply(i,t);for(var e in i._caching)this._caching[e]=i._caching[e];return o},P.prototype.getPropsHookInfo=function(){return this._propshookinfo},P.prototype.clean=function(){this._caching.length=0;for(var t in this)this[t]=null},e.setTemplateGlobalMacro=function(t,n){return 1===arguments.length?e.extend(P.globalMacro,t):2===arguments.length&&(P.globalMacro[t]=n),this},e.template=function(t,e){return new P(t,e)};var C=function(t,e){return this.fn=e,C.setObserve.call(this,t)};C.setunwrite=function(t,e,n){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:n})},C.setwrite=function(t,e,n){var r=this,i=C.setObserve(n);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){t!==i&&(i=C.setObserve.call(r,t),r.fn&&r.fn())}})},C.setObserve=function(t){var e=this;if(r.isArray(t))C.setunwrite(t,"splice",function(){return e.fn&&e.fn(),Array.prototype.splice.apply(this,Array.prototype.slice.call(arguments))}),C.setunwrite(t,"pop",function(){return e.fn&&e.fn(),Array.prototype.pop.apply(this,Array.prototype.slice.call(arguments))}),C.setunwrite(t,"push",function(t){return e.fn&&e.fn(),Array.prototype.push.apply(this,Array.prototype.slice.call(arguments))}),C.setunwrite(t,"shift",function(){return e.fn&&e.fn(),Array.prototype.shift.apply(this,Array.prototype.slice.call(arguments))}),C.setunwrite(t,"unshift",function(t){return e.fn&&e.fn(),Array.prototype.unshift.apply(this,Array.prototype.slice.call(arguments))});else if(r.isObject(t))for(var n=Object.keys(t),i=0;i<n.length;i++)C.setwrite.call(e,t,n[i],t[n[i]]);return t},e.observe=function(t,e){return new C(t,e)};var M=function(t,n,i){this.dom=t;var o=e.extend({macro:{},parameters:[],dataarray:[],renderId:null,renderDone:null},i);r.isString(n)?this.tempt=e.template(n,{macro:o.macro,parameters:o.parameters,autodom:!0,renderId:o.renderId}):this.tempt=n;var s=this.tempt.render.apply(this.tempt,o.dataarray);this.virt=this.tempt.autoDom.apply(this.tempt,o.dataarray),t.html(s),this.tempt.flush(t),this._isupdatequeue=null,this._renderDone=o.renderDone};M.prototype.update=function(t){if(!this._isupdatequeue){var e=this;setTimeout(function(){e._update(e._isupdatequeue),e._isupdatequeue=null,e._renderDone&&e._renderDone()},0)}this._isupdatequeue=t},M.prototype._update=function(t){var e=this.tempt.autoDom.apply(this.tempt,t),n=P.diff(e,this.virt);this.virt=e,P.effect(this.dom,n),this.tempt.flush(this.dom)},M.prototype.clean=function(){for(var t in this)this[t]=null},M.prototype.getPropsHookInfo=function(){return this.tempt.getPropsHookInfo()},g.prototype.autodom=function(t,e){return new M(this,t,e)};var L={regs:{a:/^(dom)|^(option)|^(name)|^(extend)|^(init)/,cn:/\.[0-9a-zA-Z-]+/g,cnn:/class=['"][\s\S]+?['"]/g,d:/\{|\}/},factory:e.adapt(),task:new c,isMutation:function(){return null!==(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver||null)},domInserted:function(t,n){var r=e(n);if(!r.dataset("parentView")){for(var i=!1;t&&t!==window.document;){if(t.datasets&&t.datasets["--view--"]){i=!0;break}t=t.parentNode}if(i){var o=t.datasets["--view--"];o.onnodeinserted&&o.onnodeinserted(n)}}},domRemoved:function(t,n){var r=e(n);if(!r.dataset("parentView")){for(var i=!1,o=t;t&&t!==window.document;){if(t.datasets&&t.datasets["--view--"]){i=!0;break}t=t.parentNode}if(i){var s=t.datasets["--view--"];s.onnoderemoved&&s.onnoderemoved(n,o)}}},getPacketName:function(t,e){if(t){if(t=t.trim(),""!==t){var n=t.split(".");return n.length>1?(n.pop(),n.join(".")):t}return""}return""},getViewInstance:function(t,e,n){var r=t.dataset("view");if(!r)throw Error("[topolr] view can not init.the element has no attribute like view-*");L.get(r,e,function(e){t.data("--view--")?n&&n(t.data("--view--")):(e.dom=t,n&&n(e))})},add:function(t){t.tagName||(t.tagName="div"),L.factory.def(t);for(var e=(t.packet&&""!==t.packet?t.packet+".":"")+t.name,n=L.factory.get(e).prototype,r=[t.className||""],i=n.__info__.types.length-1;i>=0;i--){var o=L.factory.get(n.__info__.types[i]);if(o){var s=o.prototype.className;s&&""!==s&&-1===r.indexOf(s)&&r.push(s)}}n.fullClassName=r.join(" ")},has:function(t){return L.factory.has(t)},get:function(t,e,n){if(void 0===t||null===t||""===t)throw Error("[topolr] packet name can not undefined or null or ''.");if(L.has(t))n&&n(L.factory.instance(t,e));else{var r=L.getPacketName(t);new T(r).done(function(){if(n){if(!L.has(t))throw Error("[topolr] can not find module with name of "+t+",it is not in the packet of "+L.getPacketName(t)+" or the packet file inited failed.");n(L.factory.instance(t,e))}}).fail(function(t){console.error(t)})}},isPacketName:function(t){return e.is.isString(t)&&-1===t.indexOf("<")&&-1!==t.indexOf(".")},agentEvent:function(t,e){for(var n in e)m.util.canBubbleUp(n)?t.dom.bind(n,L.agentHandler):t.dom.bind(n,L.agentHandlerUnbubbeUp,!0)},agentHandler:function(t){for(var n=t.target,r=t.currentTarget,i=r.datasets["--view--"],o=i.getShortUUID();n&&n!==window;){var s=e(n).dataset("bind");if(s){var a={},l=s.split("-"),u=l[0],c=l[1].split(" ");if(u===o){for(var p=0;p<c.length;p++){var h=c[p].split(":");a[h[0]]=h[1]}var d=a[t.type];if(d&&i["bind_"+d]&&(t.stopPropagation=function(){this._ispropagation=!0},i["bind_"+d].call(i,e(n),t),t._ispropagation))break}}if(n===r)break;n=n.parentNode}},agentHandlerUnbubbeUp:function(t){var n=t.target,r=t.currentTarget,i=r.datasets["--view--"],o=i.getShortUUID(),s=e(n).dataset("bind");if(s){var a={},l=s.split("-"),u=l[0],c=l[1].split(" ");if(u===o){for(var p=0;p<c.length;p++){var h=c[p].split(":");a[h[0]]=h[1]}var d=a[t.type];d&&i["bind_"+d]&&i["bind_"+d].call(i,e(n),t)}}},actionStyle:function(t,e,n){if(t){var i=t;r.isString(t)&&(i=[t]);for(var o=0;o<i.length;o++){for(var s=i[o],a=T.packetsmapping[e].style,l=null,u=0;u<a.length;u++)a[u].packet===s&&(l=a[u]);if(l){var c=l.value.code,p=c;if(n){for(var h=c.split(L.regs.d),d=[],u=0;u<h.length;u++){var f=h[u].trim();(u+1)%2!==0?d.push(f.replace(L.regs.cn,function(t){return t.substring(1).trim()!==n?"."+n+"-"+t.substring(1):t})):f&&d.push("{"+f+"}")}p=d.join("")}for(var g=document.getElementsByTagName("style"),v=!1,u=0;u<g.length;u++)g[u].dataset&&g[u].dataset.packet===s&&(v=!0);if(!v){var h=document.createElement("style");h.setAttribute("media","screen"),h.setAttribute("type","text/css"),h.setAttribute("data-packet",s),h.setAttribute("data-perfix",n),h.appendChild(document.createTextNode(p)),document.getElementsByTagName("head")[0].appendChild(h)}}else console.error("[topolr] style["+s+"] can not find with module of "+e)}}},parseTemplate:function(t,e,n){return t&&n?e.replace(L.regs.cnn,function(t){for(var e=t.substring(7,t.length-1).trim(),r=e.split(" "),i=[],o=0;o<r.length;o++)":"===r[o][0]?i.push(r[o].substring(1)):i.push(n+"-"+r[o]);var s=t.substr(6,1);return"class="+s+i.join(" ")+s}):e}},$={options:{},add:function(t){if(!t.name||""===t.name)throw Error("[topolr] option name can not null or ''");$.options[t.name]=t.option},has:function(t){var e=$.options[t];return e?e:!1},get:function(t,e){if(void 0!==t&&""!==t&&"null"!==t)if("{"!==t[0]&&"["!==t[0]){var n=$.has(t);if(n===!1){var r=L.getPacketName(t);new T(r).done(function(){if(e){var n=$.has(t);if(!n)throw Error("[topolr] can not find option with name of "+t+",is not in the packet of "+L.getPacketName(t));e(n)}}).fail(function(t){console.error(t)})}else e&&e(n)}else{var i={};try{i=window.JSON.parse(t)}catch(o){}e&&e(i)}else e&&e(null)}},D=function(t,e,n){this.target=t,this.data=n,this.type=e,this._goon=!0,this.currentTarget=null};D.prototype.clone=function(){return e.extend(new viewevnet,this)},D.prototype.stopPropagation=function(){this._goon=!1};var R=function(){};R["public"]={},R.localinstance={},R.getViewInfo=function(t){return{instanceId:t.instanceId(),type:t.type(),id:t.getId()}},R.getLocalInstance=function(t,n,r){if(L.factory.get(t).prototype.typeOf("localservice")){var i=R.getInstance(t,n),o=e.util.randomid(10);return i._localId=o,i.__creater__=r,R.localinstance[o]=i,o}return console.error("service "+t+" is not localservice"),null},R.setLocalService=function(t,n){var r=e.extend({},t.services);e.is.isArray(n)||(n=[n]);for(var i=0;i<n.length;i++){var o=R.localinstance[n[i]];if(o)for(var s in r){var a=r[s];if(e.is.isString(a)&&o.typeOf(a)){o._list.push(t),r[s]=o,t.services=r;try{o.onconnect&&o.onconnect(R.getViewInfo(t))}catch(l){console.error("[topolr] service onconnect error name is "+o.type()+" "+l.stack)}}else if(a.type&&a.type()&&o.typeOf(a.type())){if(o._list.push(t),r[s]=o,t.services=r,a._list&&-1!==a._list.indexOf(t)){a._list.splice(a._list.indexOf(t),1);try{a.ondisconnect&&a.ondisconnect(R.getViewInfo(t))}catch(l){console.error("[topolr] service ondisconnect error name is "+a.type()+" "+l.stack)}}try{o.onconnect&&o.onconnect(R.getViewInfo(t))}catch(l){console.error("[topolr] service onconnect error name is "+o.type()+" "+l.stack)}try{t.onservicechange&&t.onservicechange()}catch(l){console.error("[topolr] onservicechange called error of "+type.type())}}}}},R.cleanLocalInstance=function(t){var e={};for(var n in R.localinstance)R.localinstance[n].__creater__===t||R.localinstance[n].__creater__.isRemoved()?R.localinstance[n].clean():e[n]=R.localinstance[n];R.localinstance=e},R.getInstance=function(t,n){var r=L.factory.instance(t,e.extend({},n));e.extend(r,{_list:[],_queue:[],_isrunning:!1,_cache:{},data:{}});try{r.init(),r.autodata&&r.observe()}catch(i){console.error("[topolr] service init called error name of "+t+" "+i.stack)}return r},R.get=function(t,e){var n=null;if(!L.has(t))throw Error("[topolr] service can not loaded,require service first "+t);return L.factory.get(t).prototype.typeOf("publicservice")?(R["public"][t]||(R["public"][t]=R.getInstance(t,e)),n=R["public"][t]):n=R.getInstance(t,e),n},R.init=function(t){var n=t.services,r={};for(var i in n)if(e.is.isString(n[i])){var o=R.get(n[i],t.option["service_"+i]);o._list.push(t),r[i]=o;try{o.onconnect&&o.onconnect(R.getViewInfo(t))}catch(s){console.error("[topolr] service onconnect error name is "+o.type()+" "+s.stack)}}else r[i]=n[i];t.services=r},R.clean=function(t){var e=t.services;for(var n in e){var r=e[n];if(r.init){var i=r._list.indexOf(t);if(-1!==i){r._list.splice(i,1);try{r.ondisconnect&&r.ondisconnect(R.getViewInfo(t))}catch(o){console.error("[topolr] service ondisconnect error name is "+q.type()+" "+o.stack)}}!r.typeOf&&r.typeOf("publicservice")&&r.clean(),r[n]=null}}},L.add({name:"data",_request:function(t,n,i){var o=e.promise(),s=!1;o.scope(this);var a={url:"",dataType:"json",data:""};if(e.extend(a,i),r.isString(t)?(s=!0,a.url=t):r.isObject(t)&&(s=!0,e.extend(a,t)),s)return a.data=n,this._doRequest(a,o),o;throw Error("[topolr] request parameter error")},_doRequest:function(t,n){e.ajax(t).done(function(t){t.code&&"1"===t.code?n.resolve(t.data):n.reject(t)}).fail(function(t){n.reject(t)})},getRequest:function(t,e){return this._request(t,e,{type:"get"})},postRequest:function(t,e){return this._request(t,e,{type:"post"})},putRequest:function(t,e){return this._request(t,e,{type:"put"})},deleteRequest:function(t,e){return this._request(t,e,"delete")},patchRequest:function(t,e){return this._request(t,e,"get")},setStorage:function(t,e){var n="",r=window.localStorage.getItem(this.type());return r?(r=window.JSON.parse(r),r[t]=e,n=window.JSON.stringify(r)):(r={},r[t]=e,n=window.JSON.stringify(r)),window.localStorage.setItem(this.type(),n),this},getStorage:function(t){var e=window.localStorage.getItem(this.type());return e=e?window.JSON.parse(e):{},e[t]},removeStorage:function(t){return this.setStorage(t,null)},cleanStorage:function(){return window.localStorage.removeItem(this.type()),this}}),L.add({name:"service",extend:"data",option:{reverse:!1},autodata:!1,trigger:function(t,e){var n="schange",r=null;0===arguments.length?r=this.data:1===arguments.length?r=t:(n=t,r=e),n="service_"+n;for(var i=0,o=this._list.length;o>i;i++){var s=this._list[i];if(s[n])try{s[n](r)}catch(a){console.error("[topolr] service trigger called error name is "+s.type()+" view is "+s.type()+" "+a.stack)}}this._run()},triggerTo:function(t,e,n){var r="schange",i=null;0===arguments.length?i=this.data:1===arguments.length?i=n:(r=e,i=n),r="service_"+r;for(var o=0,s=this._list.length;s>o;o++){var a=this._list[o];if(a.instanceId()===t&&a[r])try{a[r](i)}catch(l){console.error("[topolr] service triggerTo called error name is "+a.type()+" view is "+a.type()+" "+l.stack)}}this._run()},start:function(){this._isrunning=!0,this._run()},stop:function(){this._isrunning=!1},isRunning:function(){return this._isrunning},cleanRepeatTask:function(){if(this._queue.length>0){for(var t=[this._queue[0]],e=1,n=this._queue.length;n>e;e++)for(var r=0,i=t.length;i>r;r++)!this._queue[e].type===t[r].type&&this._queue[e].target===t[r].target&&t.push(this._queue[e]);this._queue=t}},cleanTask:function(t){if(t){for(var e=[],n=0,r=this._queue.length;r>n;n++)this._queue[n].type===t&&e.push(this._queue[n]);this._queue=e}else this._queue=[],this._isrunning=!1},cache:function(t,e){return 0===arguments.length?this._cache.__default__:1===arguments.length?this._cache[t]:void(2===arguments.length&&(this._cache[t]=e))},getClientSize:function(){return this._list.length},clean:function(){try{this.onunload&&this.onunload()}catch(t){console.error("[topolr] onunload callback error name is "+service.type()+" "+t.stack)}this._list.length=0,this._queue.length=0;for(var e in this)"type"!==e&&(this[e]=null)},_trigger:function(t,n){var r=e.promise(),i={type:t,data:n.data,target:n.target,ps:r};return this.option.reverse?this._queue.unshift(i):this._queue.push(i),this._run(),r},_run:function(){if(this._queue.length>0&&this._isrunning===!0){var t=null,e=this;t=this.option.reverse?this._queue.shift():this._queue.pop(),t.ps.then(function(t){return e["service_"+t.type](t.data)},function(t){return console.error(t),t}).resolve(t)}},observe:function(){if(this.autodata){var t=this;e.observe(this.data,function(){t.trigger()})}return this},action_get:function(){return this.data},action_set:function(t){return e.extend(this.data,t),this}}),L.add({name:"publicservice",extend:"service"}),L.add({name:"privateservice",extend:"service"}),L.add({name:"localservice",extend:"service"}),L.add({name:"view",extend:"data",packet:"",option:{},parentView:null,marcos:{},services:[],autodom:!1,style:"",init:null,template:"",onbeforeinit:null,onendinit:null,onunload:e.nfn,onnoderemoved:null,onnodeinserted:null,onchildremove:null,onservicechange:null,onupdated:null,_render:function(t){if(!this.dom.data("--view--")){if(this._rendered=!1,L.isPacketName(this.template)){var n=this.template.split("."),r=n.pop(),i=n.join(".");this.template=T.packetsmapping[this.packet()].getTemplate(i,r)}L.actionStyle(this.style,this.packet(),this.className),this.template=L.parseTemplate(this.style,this.template,this.className),this.dom.data("--view--",this),this.dom.children().length>0&&(this.template=this.dom.html());var o=this.dom.dataset("option"),s=this;if(this.dom.hasClass("_futuretochange_")){this.dom.removeClass("_futuretochange_");var a=L.factory._mapping[this.type()].prototype,l=a.fullClassName;if(this.dom.get(0).tagName.toLowerCase()!==this.tagName){var n=e("<"+a.tagName+" class='"+l+"' data-view='"+this.dom.dataset("view")+"' data-parent-view='"+this.dom.dataset("parentView")+"' data-view-id='"+this.dom.dataset("viewId")+"' daa-option='"+this.dom.dataset("option")+"'></"+a.tagName+">");this.dom.get(0).parentNode.replaceChild(n.get(0),this.dom.get(0)),this.dom=n}}this._handlers=[],$.get(o,function(e){if(e){s.option.override=e.override||{};for(var n in e)"override"!==n&&(0===n.indexOf("override_")?s.option.override[n.substring(9)]=e[n]:s.option[n]=e[n])}for(var n in s.option.override)L.regs.a.test(n)||(s[n]=s.option.override[n]);if(s.name=s.type(),s.shortname=s.shortName(),"function"==typeof s.onbeforeinit)try{s.onbeforeinit(s.option)}catch(r){console.error("[topolr] onbeforeinit called error with module of "+s.type()+" Message:"+r.stack)}if(s.className&&""!==s.className&&s.dom.addClass(s.className),R.init(s),"function"==typeof s.init)try{s.init(s.option)}catch(r){console.error("[topolr] init called error with module of "+s.type()+" Message:"+r.stack)}if("function"==typeof s.onendinit)try{s.onendinit(s.option)}catch(r){console.error("[topolr] onendinit called error with module of "+s.type()+" Message:"+r.stack)}t&&t()})}return this},getId:function(){return this.dom.dataset("viewId")},getDom:function(){return this.dom},request:function(t){return e.ajax(t)},triggerEvent:function(t){return t.currentTarget=this,this._handlers[t.type]?this._handlers[t.type].call(this,t):this["event_"+t.type]?this["event_"+t.type].call(this,t):!0},initEvent:function(t,e){var n=new D(this,t,e);return n},dispatchEvent:function(t,e,n){n=void 0===n?!0:n;var r=new D(this,t,e);if(n===!0)for(var i=this;i&&(i.triggerEvent(r),r._goon);)i=i.parentView;else if(this.triggerEvent(r),r._goon&&this.typeOf("viewgroup"))for(var i=0;i<this.children.length;i++)this.children[i].dispatchEvent(t,e,!1)},dispatchSuroundEvent:function(t,e){var n=new D(this,t,e);if(this.parentView)for(var r in this.parentView.children){var i=this.parentView.children[r];if(i.triggerEvent(n),!n._goon)break}},addEventListener:function(t,e){return this._handlers[t]=e,this},removeEventListener:function(t,e){return this._handlers[t]=null,this["event_"+t]&&(this["event_"+t]=null),this},removeAllEventListener:function(){for(var t in this._handlers)this._handlers[t]=null;for(var t in this)0===t.indexOf("event_")&&(this[t]=null);return this},remove:function(){this.dom.remove()},render:function(){var t=this,n=e.promise();n.scope(this);try{t.onbeforerender&&t.onbeforerender()}catch(r){console.error("[topolr] onbeforerender called error with module of "+t.type()+" Message:"+r.stack)}try{var i=Array.prototype.slice.call(arguments);t.autodom?(t.autodomc=t.dom.autodom(t.template,{macro:t.marcos,parameters:["data"],dataarray:i,renderId:t.getShortUUID(),renderDone:function(){try{t.onupdated&&t.onupdated()}catch(e){console.error("[topolr] onupdated called error with module of "+t.type()+" Message:"+e.stack)}}}),L.agentEvent(t,t.autodomc.getPropsHookInfo())):(t.tempt||(t.tempt=e.template(t.template,{macro:t.marcos,parameters:["data"],renderId:t.getShortUUID()}),L.agentEvent(t,t.tempt.getPropsHookInfo())),i.unshift(t.dom),t.tempt.renderTo.apply(t.tempt,i))}catch(r){console.error("[topolr] render called error with module of "+t.type()+" Message:"+r.stack)}try{t.onendrender&&t.onendrender()}catch(r){console.error("[topolr] onendrender called error with module of "+t.type()+" Message:"+r.stack)}return t._rendered=!0,setTimeout(function(){n.resolve()},0),n},update:function(){this._rendered===!0?this.autodom&&this.autodomc&&this.autodomc.update(Array.prototype.slice.call(arguments)):this.render.apply(this,Array.prototype.slice.call(arguments))},original:function(t){for(var n=this,r=0;n.constructor!==Object&&2>r;)n[t]&&r++,n=Object.getPrototypeOf(n);if(2===r){var i=n[t];if(e.is.isFunction(i)){var o=Array.prototype.slice.call(arguments);return o.splice(0,1),i.apply(this,o)}return e.extend(!0,{},i)}},parentsInvoke:function(t){for(var n=this.parentView,r=null;n;){var i=n[t];if(i&&e.is.isFunction(i)){var o=Array.prototype.slice.call(arguments);o.splice(0,1),r=i.apply(n,o);break}n=n.parentView}return r},parentsParameter:function(t){for(var e=this.parentView,n=null;e&&(n=e.parameters[t],void 0===n);)e=e.parentView;return n},parentViews:function(t){t=e.is.isAvalid(t)?e.is.isNumber(t)?t:parseInt(t):0;for(var n=this.parentView,r=t-1;n&&r>0;)r--,n=n.parentView;return n},previousSibling:function(){if(this.parentView){var t=this.parentView.children.indexOf(this);return 0!==t?this.parentView.children[t-1]:null}return null},nextSibling:function(){if(this.parentView){var t=this.parentView.children.indexOf(this);return t+1<this.parentView.children.length?this.parentView.children[t+1]:null}return null},clean:function(){try{this.onunload()}catch(t){console.error("[topolr] onunload called error with module of "+this.type()+" Message:"+t.stack)}var e=this.parentView;if(e&&e.children){var n=e.children.indexOf(this);if(-1!==n){e.children.splice(n,1);try{e.onchildremove&&e.onchildremove(this)}catch(t){console.error("[topolr] onchildremove called error with module of "+e.type()+" Message:"+t.stack)}}}R.clean(this);var r=Object.keys(this);for(var i in r)this[r[i]]=null},finders:function(t){return this.dom.find("[data-find='"+(this.getShortUUID()+"-"+t)+"']")},groups:function(t){return this.dom.find("[data-group='g:"+(this.getShortUUID()+"-"+t)+"']")},service_schange:function(t,e){this.update(t)},getService:function(t){var e=this.services[t],n=this;return e?{trigger:function(t,r){return e._trigger(t,{data:r,target:n})},action:function(){var t=Array.prototype.slice.call(arguments),n=t.shift();return e["action_"+n]?e["action_"+n].apply(e,t):null},isRunning:function(){return e._isrunning}}:null},triggerService:function(){var t=Array.prototype.slice.call(arguments),e=t.shift().split("."),n=e[0],r=e[1];return t.unshift(r),this.getService(n).trigger.apply({},t)},excuteService:function(){var t=Array.prototype.slice.call(arguments),e=t.shift().split("."),n=e[0],r=e[1];t.unshift(r);var i=this.getService(n);if(i)return i.action.apply({},t);throw Error("service can not find name is "+n+",view is "+this.type())},isRemoved:function(){return null===this.dom}}),L.add({name:"viewgroup",extend:"view",layout:null,oninitchild:null,oninitchildend:null,option:{},_render:function(t){if(!this.dom.data("--view--")){if(this._rendered=!1,L.isPacketName(this.layout)){var n=this.layout.split("."),r=n.pop(),i=n.join(".");this.layout=T.packetsmapping[this.packet()].getTemplate(i,r)}L.actionStyle(this.style,this.packet(),this.className),this.dom.data("--view--",this),this._handlers={},this.children=[];var o=this,s=this.dom.dataset("option");e.queue();if(this.dom.hasClass("_futuretochange_")){this.dom.removeClass("_futuretochange_");var a=L.factory._mapping[this.type()].prototype,l=a.fullClassName;if(this.dom.get(0).tagName.toLowerCase()!==this.tagName){var n=e("<"+a.tagName+" class='"+l+"' data-view='"+this.dom.dataset("view")+"' data-parent-view='"+this.dom.dataset("parentView")+"' data-view-id='"+this.dom.dataset("viewId")+"' daa-option='"+this.dom.dataset("option")+"'></"+a.tagName+">");
this.dom.get(0).parentNode.replaceChild(n.get(0),this.dom.get(0)),this.dom=n}}try{$.get(s,function(n){if(o.option||(o.option={}),o.option.override||(o.option.override={}),n){for(var r in n)0===r.indexOf("override_")&&"override"!==r?o.option.override[r.substring(9)]=n[r]:o.option[r]=n[r];for(var r in n.override)o.option.override[r]=n.override[r]}for(var r in o.option.override)L.regs.a.test(r)||(o[r]=o.option.override[r]);if("function"==typeof o.onbeforeinit)try{o.onbeforeinit(o.option)}catch(i){console.error("[topolr] onbeforeinit called error with module of "+o.type()+" Message:"+i.stack)}R.init(o);try{o.onbeforerender&&o.onbeforerender()}catch(i){console.error("[topolr] onbeforerender called error with module of "+o.type()+" Message:"+i.stack)}var s=o.layout;if(!s&&o.dom.children().length>0&&(s=o.dom.html()),e.is.isString(s))try{s=L.parseTemplate(o.style,s,o.className),o.layout=s;var a=e.extend({module:function(t,e){var n=t.type,r=t.option,i=t.id,s={tagName:"div",fullClassName:"_futuretochange_"};if(L.factory._mapping[n])var s=L.factory._mapping[n].prototype;return"<"+s.tagName+" class='"+s.fullClassName+"' data-parent-view='"+o.getId()+"' data-view='"+n+"' data-view-id='"+(void 0!==i&&null!==i?i:o.getId()+"-"+o.children.length)+"' data-option='"+(r||"")+"'></"+s.tagName+">"}},o.marcos),l=e.template(s,{macro:a,parameters:["data","pid","option"],autodom:o.autodom,renderId:o.getShortUUID()});o.autodom?(o.autodomc=o.dom.autodom(l,{macro:a,parameters:["data","pid","option"],dataarray:[o.option,o.getId(),o.option],renderId:o.getShortUUID(),renderDone:function(){o.privator("updatechild",function(t){try{t.onupdated&&t.onupdated()}catch(e){console.error("[topolr] onupdated called error with module of "+t.type()+" Message:"+e.stack)}})}}),L.agentEvent(o,o.autodomc.getPropsHookInfo())):(o.tempt=l,L.agentEvent(o,o.tempt.getPropsHookInfo()),l.renderTo(o.dom,o.option,o.getId(),o.option))}catch(i){console.error("[topolr] parse layout called error with module of "+o.type()+" Message:"+i.stack),o.dom.html("")}try{o.onendrender&&o.onendrender()}catch(i){console.error("[topolr] onendrender called error with module of "+o.type()+" Message:"+i.stack)}if("function"==typeof o.onnodeinserted)try{o.onnodeinserted(o.dom)}catch(i){console.error("[topolr] onnodeinserted called error with module of "+o.type()+" Message:"+i.stack)}o._rendered=!0,o.privator("updatechild",function(e){if(e.name=e.type(),e.shortname=e.shortName(),e.className&&""!==e.className&&e.dom.addClass(e.className),"function"==typeof e.init)try{e.init(e.option)}catch(n){console.error("[topolr] init called error with module of "+o.type()+" Message:"+n.stack)}if("function"==typeof e.onendinit)try{e.onendinit(e.option)}catch(n){console.error("[topolr] onendinit called error with module of "+o.type()+" Message:"+n.stack)}t&&t()})})}catch(u){t&&t(),console.error(u.stack)}}return this},_addChild:function(t,n){var i=this,o=e.extend({type:null,option:"",parameters:null,localService:null,id:this.getId()+"-"+this.children.length,container:"body",domIndex:null,target:null,index:null},t),s=o.index;o.container.isWrapper&&!o.container.isWrapper()&&(o.container="body");try{L.get(o.type,null,function(t){void 0===s||null===s||s>=i.children.length?i.children.push(t):i.children.splice(s,0,t);var a=L.factory._mapping[t.type()].prototype.fullClassName,l=e(o.container),u=e("<"+t.tagName+" class='"+a+"' data-parent-view='"+i.getId()+"' data-view='"+o.type+"' data-view-id='"+o.id+"' data-option='"+(r.isObject(o.option)?"":o.option)+"'></"+t.tagName+">");if(r.isNumber(o.domIndex)){var c=l.children(o.domIndex);c.length>0?t.dom=u.insertBefore(c):t.dom=u.appendTo(l,!1)}else t.dom=u.appendTo(l,!1);for(var p={},h=t.__info__.types.length-1;h>=0;h--)e.extend(p,i.option[t.__info__.types[h]]);if(e.extend(p,e.json.clone(t.option)),e.extend(p,i.option[o.id]),e.extend(p,i.option[o.type]),r.isObject(o.option)){var d={};d.override=o.option.override||{};for(var h in o.option)"override"!==h&&(0===h.indexOf("override_")?d.override[h.substring(9)]=o.option[h]:d[h]=o.option[h]);t.option=e.extend(p,d);for(var h in t.option.override)L.regs.a.test(h)||(t[h]=t.option.override[h])}if(i.dom.contain(t.dom)||(t.___outer___=!0),i.oninitchild)try{i.oninitchild(t)}catch(f){console.error("[topolr] oninitchild called error with module of "+i.type()+" ["+f.stack+"]")}t.option=p,t.parameters=o.parameters,t.target=o.target,t.parentView=i,o.localService&&R.setLocalService(t,o.localService),t.privator("render",function(){if("function"==typeof i.oninitchildend)try{i.oninitchildend(t)}catch(e){console.error("[topolr] oninitchildend called error with module of "+i.type()+" ["+e.stack+"]")}n&&n.call(t)})})}catch(a){n&&n.call(null),console.error(a.stack)}},_updatechild:function(t){var n=e.queue(),r=this;n.complete(function(e){t&&t(e)}),this.dom.find("*[data-parent-view='"+this.getId()+"']").each(function(){n.add(function(t,n){var i=this;if(n.getModule())i.next(t);else{var o={},s=n.dataset("view"),a=n.dataset("viewId");L.get(s,null,function(s){for(var l=s.__info__.types.length-1;l>=0;l--)e.extend(o,t.option[s.__info__.types[l]]);if(e.extend(o,t.option[a]),e.extend(s.option,o),n.data("--view--"))i.next(t);else{var u=s;if(u.dom=n,u.parentView=t,t.oninitchild)try{t.oninitchild(u)}catch(c){console.error("[topolr] oninitchild called error with module of "+r.type()+" Message:"+c.stack)}t.children.push(u),u.privator("render",function(){if(t.oninitchildend)try{t.oninitchildend(u)}catch(e){console.error("[topolr] oninitchildend called error with module of "+r.type()+" Message:"+e.stack)}i.next(t)})}})}},function(t,e){console.error(e),this.next(r)},e(this))}),n.run(this)},render:function(){},reRender:function(){var t=e.promise();return t.scope(this),this.dom.unbind(),this.dom.get(0).datasets={},this.privator("render",function(){t.resolve()}),t},update:function(t){this.autodom&&this.autodomc&&this.autodomc.update([t||this.option,this.getId(),this.option])},getChildrenByType:function(t){for(var e=[],n=0;n<this.children.length;n++)this.children[n].typeOf(t)&&e.push(this.children[n]);return e},getChildByType:function(t,e){return e=void 0===e||e===e?0:e,this.getChildrenByType(t)[e]},getChildById:function(t){for(var e=null,n=0;n<this.children.length;n++)if(this.children[n].getId()===t){e=this.children[n];break}return e},getChildAt:function(t){return e.is.isNumber(t)&&t>=0&&t<this.children.length?this.children[t]:null},childEach:function(t){for(var e=0;e<this.children.length&&t&&t.call(this.children[e],this.children[e],e,this.children)!==!1;e++);},contains:function(t){return-1!==this.children.indexOf(t)},getFirstChild:function(t){return e.is.isAvalid(t)?this.getChildrenByType(t)[0]:this.children[0]},getLastChild:function(t){var n=null;if(e.is.isAvalid(t)){var r=this.getChildrenByType(t);r.length>0&&(n=r[r.length-1])}else this.children.length>0&&(n=this.children[this.children.length-1]);return n},getChildIndex:function(t){return this.children.indexOf(t)},addChild:function(t){var e=this,n=new p;return n.scope(this),L.task.add(function(t,r){var i=this;e.privator("addChild",r,function(){i.next(),n.resolve(this)})},null,t),n},setChildIndex:function(t,e){if(void 0!==e&&null!==e&&e<this.children.length-1){var n=this.children.indexOf(t);this.children.splice(n,1),this.children.splice(e,0,t)}return this},duplicateChild:function(t,n){return t&&this.privator("addChild",null,{type:this.name,option:e.extend({},this.option),parameters:this.parameters,id:n||this.getId()+"-"+this.children.length,container:this.dom.parent()}),this},removeChild:function(t){var e=this.getChildById(t);return e&&e.remove(),this},removeChildAt:function(t){return e.is.isNumber(t)&&t>0&&t<this.children.length&&this.children[t].remove(),this},removeAllChild:function(){for(;this.children.length>0;)this.children.pop().remove();return this},clean:function(){var t=[];for(var e in this.children)this.children[e].___outer___&&t.push(this.children[e]);for(;t.length>0;)t.pop().remove();try{this.onunload()}catch(n){console.error("[topolr] onunload called error with module of "+this.type()+" Message:"+n.stack)}var r=this.parentView;if(r&&r.children){var i=r.children.indexOf(this);if(-1!==i){r.children.splice(i,1);try{r.onchildremove&&r.onchildremove(this)}catch(n){console.error("[topolr] onchildremove called error with module of "+r.type()+" Message:"+n.stack)}}}R.clean(this),R.cleanLocalInstance(this);var o=Object.keys(this);for(var e in o)this[o[e]]=null},createLocalService:function(t,e){return R.getLocalInstance(t,e,this)},setLocalService:function(t,e){R.setLocalService(t,e)}}),L.add({name:"root",extend:"viewgroup",className:"root",init:function(){L.isMutation()?this.dom.mutationObserve(function(t){for(var e=0;e<t.length;e++){for(var n=t[e],r=n.addedNodes,i=n.removedNodes,o=0;o<r.length;o++)L.domInserted(r[o].parentNode,r[o]);for(var o=0;o<i.length;o++)L.domRemoved(n.target,i[o])}},{childList:!0,subtree:!0}):this.dom.bind("DOMNodeInserted",function(t){L.domInserted(t.target.parentNode,t.target)}).bind("DOMNodeRemoved",function(t){L.domRemoved(t.path[1],t.target)}),console.log("[topolr] root view init.")}}),x.option.debug&&(window["topolr-source"]=O,window["topolr-packet"]=T,window["topolr-module"]=L,window["topolr-app"]=x);var F={};e.overrideModule=function(t,e){var n=L.factory.get(t);if(n)for(var r in e)"init"!==r&&"option"!==r&&"extend"!==r&&(n.prototype[r]=e[r])},e.Option=function(t){if(r.isString(t)){var n=$.has(t);return n?o.clone(n):null}var i=t.option,s=[];t.extend&&(r.isString(t.extend)?s.push(t.extend):s=t.extend);for(var a=0;a<s.length;a++){var n=$.has(s[a]);if(!n)throw Error("[topolr ] can not find option with name of "+s[a]);e.extend(i,o.clone(n))}for(var a in t.override)for(var l=a.split("."),u=i,c=0;c<=l.length-1;c++){var p=l[c],h=u[p];r.isObject(h)||(u[p]={}),c===l.length-1?u[p]=t.override[a]:u=u[p]}$.add(t)},e.Module=function(t){L.add(t)},e.override=function(t,n){r.isString(t)&&r.isObject(n)&&(F[t]?e.extend(F[t],n):F[t]=e.extend(new g,n))},e.toggle=function(t){r.isString(t)?F[t]&&(h.prototype=F[t]):h.prototype=new g},e.global={},e.fn=g.prototype,window.topolr=e,window.App=e.app,window.$=e}();